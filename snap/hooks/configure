#!/bin/sh


toml_kvp() {
	printf "%s = \"%s\"\n" "$1" "$2"
}

toml_new_section() {
	printf "\n\n"
	printf "[%s]\n" "$1"
}

{
	toml_kvp "hostname" "$(cat /etc/hostname)"

	snapctl get raw-config

	toml_new_section "aziot_keys"
	toml_kvp "homedir_path" "$SNAP_COMMON/libaziot_keys_homedir"

} > $SNAP_DATA/etc/aziot/config.toml

$SNAP/bin/aziotctl config apply
