<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1111px" preserveAspectRatio="none" style="width:1097px;height:1111px;" version="1.1" viewBox="0 0 1097 1111" width="1097px" zoomAndPan="magnify"><defs><filter height="300%" id="fs97elumeyjll" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="252" x="428.5" y="17.4023">Data Flow - new architecture</text><!--MD5=[4034dc877b8eccbaf2b7bb77a2a7acd3]
cluster DPS Service--><path d="M118.2203,549.1426 C121.6672,543.3991 125.1522,541.9171 129.9921,547.7228 C132.4761,542.2199 135.6269,541.0495 140.4442,545.1951 C142.7916,538.9422 146.7139,538.4016 150.884,543.5219 C153.1809,537.0789 158.4063,536.5561 162.8096,541.2706 C165.4972,535.0147 170.1768,535.9603 173.7837,540.3203 C178.2175,537.3752 181.4454,537.9559 183.4141,543.2141 C187.1452,537.7172 190.7852,537.4308 194.542,543.1886 C198.366,537.5718 203.1976,538.5627 205.7328,544.4431 C209.9593,540.6134 214.798,540.9104 216.3704,547.2261 C224.9364,540.3021 231.9707,544.5969 234,554.1992 C234.463,553.9892 234.7619,554.1436 234.8374,554.6514 C242.559,557.4781 243.293,561.863 238.6453,568.1731 C244.4474,571.8646 245.49,575.8941 239.2576,580.1984 C246.4306,581.6578 247.3594,585.6788 243.394,591.2914 C248.6175,597.2513 247.2242,602.1266 239.3375,603.8527 C245.7762,608.6813 244.1385,614.7823 236.7952,616.9319 C243.8471,626.7028 237.7344,634.9656 227,635.1992 C227.5789,635.3795 227.6021,635.9306 227.2006,636.291 C224.0647,641.0653 219.7274,640.8646 217.4185,635.4936 C214.3453,640.6457 210.4367,641.2905 206.3008,636.7071 C203.728,643.4507 198.7845,643.6298 194.6466,638.2063 C191.6832,642.9533 187.7925,643.8592 184.5504,638.4842 C181.0915,642.6854 175.8353,642.7184 174.0628,636.7458 C171.4766,643.8184 165.1788,643.2554 161.2621,638.1436 C158.6066,642.4017 154.5902,642.7154 152.164,637.9134 C148.2658,643.2947 143.9428,644.0119 140.095,637.8606 C135.7447,642.058 132.4323,640.9755 129.9188,635.8547 C119.161,643.1796 113.1139,640.7628 110,628.1992 C110.849,628.6714 110.9491,629.2445 110.3038,629.9726 C103.9391,627.1265 103.8392,621.8142 109.2627,617.9475 C101.6238,614.8505 101.5918,609.6034 107.5558,604.7475 C101.8398,602.0708 100.5724,597.0327 106.3513,593.161 C100.0158,588.1505 102.0409,581.4002 109.2543,579.2087 C103.9574,574.8611 105.3049,571.0673 110.7578,568.186 C101.7518,559.2077 106.6656,550.425 117,547.1992 C118.2531,547.2243 118.7466,548.0002 118.2203,549.1426 " fill="#FFFFFF" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="83" x="130.5" y="565.7344">DPS Service</text><!--MD5=[9cc3614b0e94473f1fa5351936eadb26]
cluster PKI--><path d="M281.1704,548.0099 C284.6736,541.2717 289.6921,541.2788 294.7413,546.2124 C297.5851,540.9323 300.6307,540.0703 305.0254,544.5839 C308.1437,538.8454 314.5561,538.2052 318.4314,543.6789 C320.4395,537.8965 325.2532,537.8584 329.0679,541.6774 C333.4836,536.4301 340.208,536.3515 342.9354,543.5575 C346.2883,539.4466 350.5612,538.767 353.0571,544.4436 C358.069,538.9191 363.7597,539.2284 367.0766,546.3262 C376.264,541.2669 381.9691,543.8753 384,554.1992 C385.5053,554.0581 386.3458,554.8739 385.6483,556.3901 C391.99,559.0062 392.5254,563.9918 387.6139,568.4431 C393.7132,571.1064 394.4459,575.618 390.0557,580.4199 C396.2281,582.9362 398.1884,587.244 392.9498,592.4952 C397.5015,597.7198 396.1847,602.088 389.7157,604.2909 C395.7076,609.2973 395.5179,614.8375 387.8287,617.9545 C393.8735,628.9547 388.9492,635.4982 377,635.1992 C377.3516,635.3793 377.3498,635.6483 377.0617,635.8859 C375.0443,642.1007 370.3269,642.236 366.3055,637.9359 C363.5161,644.7603 358.4639,644.6538 353.6503,640.2089 C351.3542,646.2636 346.7093,646.3975 342.7478,641.9352 C340.8012,648.6633 334.8638,649.6048 330.4938,644.4302 C325.5998,648.3958 321.3001,648.7488 319.0315,641.6985 C314.6753,646.1587 309.4564,645.7989 306.6232,639.8781 C302.045,645.1954 298.1674,644.7516 294.9873,638.475 C283.236,644.1031 276.0515,642.382 274,628.1992 C274.4285,628.2004 274.507,628.481 274.3613,628.8177 C269.4407,624.9681 268.602,620.3534 274.8188,616.9326 C269.4473,614.0245 267.6659,608.2586 273.8633,604.4639 C266.9393,600.5694 267.4515,595.5562 273.5075,591.3105 C268.5375,587.0804 268.4965,582.0141 274.7122,578.8669 C269.0196,576.856 269.184,571.7924 273.3487,568.4866 C265.2446,558.2414 268.4636,550.0256 281,547.1992 C281.4744,547.3794 281.4627,547.6685 281.1704,548.0099 " fill="#FFFFFF" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="24" x="317" y="565.7344">PKI</text><!--MD5=[4b6597e5202bb255e27abc7ed2ac90aa]
cluster IoT Hub Service--><path d="M407.4363,53.9054 C411.066,47.6412 416.1074,48.6346 419.5906,54.0576 C421.6489,48.2139 426.2884,47.7155 429.9346,52.5143 C433.4351,45.5104 437.4728,46.3908 442.1756,51.2765 C443.8064,44.9203 448.9589,43.2845 453.5496,48.3217 C455.3183,43.0112 460.0218,42.7819 462.9693,47.1777 C466.5864,41.551 470.4658,41.5735 474.709,46.4798 C479.2088,40.7709 484.6216,41.9636 486.9222,48.6472 C489.9059,44.6258 493.8584,43.9932 496.5099,48.9999 C500.4829,43.674 504.6203,44.2431 508.0737,49.5643 C511.6429,45.4737 517.1187,46.0428 519.1599,51.3641 C523.8304,45.6664 528.8475,46.0842 531.7818,53.0892 C540.0193,46.4555 547.3738,49.4714 548,60.1992 C548.6374,60.0767 549.1531,60.4781 548.8759,61.1759 C554.7213,64.1687 554.2408,68.9363 549.7084,72.6802 C557.209,74.6504 558.0927,81.0532 552.5638,85.8487 C559.3469,88.4377 559.2985,94.4602 553.4268,97.9516 C560.0085,102.9723 557.7375,108.3863 551.2721,111.3011 C556.111,114.9733 555.7652,120.5075 549.8846,122.8971 C556.5921,132.9268 552.1652,139.8457 541,141.1992 C542.2811,140.9559 542.949,141.4683 542.5957,142.8271 C539.871,148.2418 534.2433,149.0864 530.6135,143.8449 C528.6768,149.5205 523.8958,149.8075 520.4927,145.3026 C516.7259,151.5656 511.6524,150.0749 508.6707,144.5174 C505.0907,150.0749 501.6448,149.994 497.2962,145.3766 C494.3984,152.2963 490.1329,152.9712 485.2353,147.2908 C482.9657,153.2421 478.0479,154.078 474.1224,148.9519 C469.7464,152.5405 466.2064,152.3998 463.8021,146.7493 C460.4789,152.1904 454.6315,151.0013 451.9935,145.9761 C448.0416,149.8726 444.3748,149.7301 441.5498,144.6631 C437.9325,149.5479 432.9912,149.239 430.1626,143.7937 C426.8974,148.1295 423.3406,148.5957 420.1068,143.7594 C409.2912,151.4935 401.5382,145.9771 400,134.1992 C400.8806,133.9471 401.4106,134.2966 401.4222,135.2362 C393.5865,132.4606 393.8146,128.1838 398.5748,122.5754 C393.3356,120.4864 390.9329,115.5336 396.0898,111.1781 C389.0297,108.0746 389.3365,103.9586 393.7695,98.7154 C388.6194,93.5061 390.6443,87.7827 397.4579,86.0604 C393.1025,81.5248 393.6882,77.4022 399.3598,74.5189 C392.0478,65.7697 393.4137,54.4592 407,53.1992 C407.4147,53.1973 407.6306,53.531 407.4363,53.9054 " fill="#FFFFFF" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="113" x="417.5" y="71.7344">IoT Hub Service</text><!--MD5=[7794c020febe37fee2610325f7805d30]
cluster Identity Service--><polygon fill="#FF00FF" filter="url(#fs97elumeyjll)" points="308,702.1992,318,692.1992,495,692.1992,495,807.1992,485,817.1992,308,817.1992,308,702.1992" style="stroke: #000000; stroke-width: 1.5;"/><line style="stroke: #000000; stroke-width: 1.5;" x1="485" x2="494" y1="702.1992" y2="693.1992"/><line style="stroke: #000000; stroke-width: 1.5;" x1="308" x2="485" y1="702.1992" y2="702.1992"/><line style="stroke: #000000; stroke-width: 1.5;" x1="485" x2="485" y1="702.1992" y2="817.1992"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="42" x="376.5" y="718.7344">«new»</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="111" x="342" y="735.2227">Identity Service</text><!--MD5=[9e5069793647d3bf2dd98c06c7283a6f]
cluster Key Service--><polygon fill="#FF00FF" filter="url(#fs97elumeyjll)" points="360,876.1992,370,866.1992,517,866.1992,517,981.1992,507,991.1992,360,991.1992,360,876.1992" style="stroke: #000000; stroke-width: 1.5;"/><line style="stroke: #000000; stroke-width: 1.5;" x1="507" x2="516" y1="876.1992" y2="867.1992"/><line style="stroke: #000000; stroke-width: 1.5;" x1="360" x2="507" y1="876.1992" y2="876.1992"/><line style="stroke: #000000; stroke-width: 1.5;" x1="507" x2="507" y1="876.1992" y2="991.1992"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="42" x="413.5" y="892.7344">«new»</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="81" x="394" y="909.2227">Key Service</text><!--MD5=[4e0ace6db1f04dc49a616f890a95ce58]
cluster Certificate Service--><polygon fill="#FF00FF" filter="url(#fs97elumeyjll)" points="557,876.1992,567,866.1992,763,866.1992,763,981.1992,753,991.1992,557,991.1992,557,876.1992" style="stroke: #000000; stroke-width: 1.5;"/><line style="stroke: #000000; stroke-width: 1.5;" x1="753" x2="762" y1="876.1992" y2="867.1992"/><line style="stroke: #000000; stroke-width: 1.5;" x1="557" x2="753" y1="876.1992" y2="876.1992"/><line style="stroke: #000000; stroke-width: 1.5;" x1="753" x2="753" y1="876.1992" y2="991.1992"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="42" x="635" y="892.7344">«new»</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="130" x="591" y="909.2227">Certificate Service</text><!--MD5=[8ff2ff8eaa8b0e22a01544f4bdf4d05f]
cluster Edge Module Runtime--><polygon fill="#FFFF00" filter="url(#fs97elumeyjll)" points="553,349.1992,563,339.1992,787,339.1992,787,633.1992,777,643.1992,553,643.1992,553,349.1992" style="stroke: #000000; stroke-width: 1.5;"/><line style="stroke: #000000; stroke-width: 1.5;" x1="777" x2="786" y1="349.1992" y2="340.1992"/><line style="stroke: #000000; stroke-width: 1.5;" x1="553" x2="777" y1="349.1992" y2="349.1992"/><line style="stroke: #000000; stroke-width: 1.5;" x1="777" x2="777" y1="349.1992" y2="643.1992"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="75" x="628.5" y="365.7344">«modified»</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="158" x="587" y="382.2227">Edge Module Runtime</text><!--MD5=[7cbe1a5fc3e046c9a58895a21185779e]
cluster MR Legacy Service--><polygon fill="#FFFF00" filter="url(#fs97elumeyjll)" points="597,403.1992,734,403.1992,741,425.6875,744,425.6875,744,490.1992,597,490.1992,597,403.1992" style="stroke: #000000; stroke-width: 1.5;"/><line style="stroke: #000000; stroke-width: 1.5;" x1="597" x2="741" y1="425.6875" y2="425.6875"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="131" x="601" y="418.7344">MR Legacy Service</text><!--MD5=[9b13154502175b34a7dde17b32f1f8a1]
cluster Edge Agent--><polygon fill="#FFFFFF" filter="url(#fs97elumeyjll)" points="801,208.1992,811,198.1992,1075,198.1992,1075,280.1992,1065,290.1992,801,290.1992,801,208.1992" style="stroke: #000000; stroke-width: 1.5;"/><line style="stroke: #000000; stroke-width: 1.5;" x1="1065" x2="1074" y1="208.1992" y2="199.1992"/><line style="stroke: #000000; stroke-width: 1.5;" x1="801" x2="1065" y1="208.1992" y2="208.1992"/><line style="stroke: #000000; stroke-width: 1.5;" x1="1065" x2="1065" y1="208.1992" y2="290.1992"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="81" x="893.5" y="224.7344">Edge Agent</text><!--MD5=[7d68aa027216ad083fcdb57666e906fc]
cluster Host-level module--><polygon fill="#FFFFFF" filter="url(#fs97elumeyjll)" points="22,892.1992,32,882.1992,336,882.1992,336,981.1992,326,991.1992,22,991.1992,22,892.1992" style="stroke: #000000; stroke-width: 1.5;"/><line style="stroke: #000000; stroke-width: 1.5;" x1="326" x2="335" y1="892.1992" y2="883.1992"/><line style="stroke: #000000; stroke-width: 1.5;" x1="22" x2="326" y1="892.1992" y2="892.1992"/><line style="stroke: #000000; stroke-width: 1.5;" x1="326" x2="326" y1="892.1992" y2="991.1992"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="136" x="107" y="908.7344">Host-level module</text><!--MD5=[b606e694e189a5e0bde06dd1b8d0f0e0]
cluster Edge Hub--><polygon fill="#FFFFFF" filter="url(#fs97elumeyjll)" points="466,208.1992,476,198.1992,777,198.1992,777,280.1992,767,290.1992,466,290.1992,466,208.1992" style="stroke: #000000; stroke-width: 1.5;"/><line style="stroke: #000000; stroke-width: 1.5;" x1="767" x2="776" y1="208.1992" y2="199.1992"/><line style="stroke: #000000; stroke-width: 1.5;" x1="466" x2="767" y1="208.1992" y2="208.1992"/><line style="stroke: #000000; stroke-width: 1.5;" x1="767" x2="767" y1="208.1992" y2="290.1992"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="68" x="583.5" y="224.7344">Edge Hub</text><!--MD5=[e8cfd881e0c7b95e10a1bb0d559cc9f2]
entity DPS Gateway--><rect fill="#FFFFFF" filter="url(#fs97elumeyjll)" height="52.9766" style="stroke: #A80036; stroke-width: 1.5;" width="107" x="118.5" y="574.1992"/><rect fill="#FFFFFF" height="5" style="stroke: #A80036; stroke-width: 1.5;" width="10" x="113.5" y="579.1992"/><rect fill="#FFFFFF" height="5" style="stroke: #A80036; stroke-width: 1.5;" width="10" x="113.5" y="617.1758"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="61" x="141.5" y="597.7344">«service»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="87" x="128.5" y="614.2227">DPS Gateway</text><!--MD5=[344739cc555d75ba553dad245e8ebc3e]
entity PKI Service--><rect fill="#FFFFFF" filter="url(#fs97elumeyjll)" height="52.9766" style="stroke: #A80036; stroke-width: 1.5;" width="93" x="282.5" y="574.1992"/><rect fill="#FFFFFF" height="5" style="stroke: #A80036; stroke-width: 1.5;" width="10" x="277.5" y="579.1992"/><rect fill="#FFFFFF" height="5" style="stroke: #A80036; stroke-width: 1.5;" width="10" x="277.5" y="617.1758"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="61" x="298.5" y="597.7344">«service»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="73" x="292.5" y="614.2227">PKI Service</text><!--MD5=[90fbbf7b6c870618297b0507f9a7a4e4]
entity IoTHub Gateway--><rect fill="#FFFFFF" filter="url(#fs97elumeyjll)" height="52.9766" style="stroke: #A80036; stroke-width: 1.5;" width="131" x="408.5" y="80.1992"/><rect fill="#FFFFFF" height="5" style="stroke: #A80036; stroke-width: 1.5;" width="10" x="403.5" y="85.1992"/><rect fill="#FFFFFF" height="5" style="stroke: #A80036; stroke-width: 1.5;" width="10" x="403.5" y="123.1758"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="61" x="443.5" y="103.7344">«service»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="111" x="418.5" y="120.2227">IoTHub Gateway</text><!--MD5=[084e4c2da341887b8d9e91d65abc0526]
entity IS API Server--><rect fill="#00FFFF" filter="url(#fs97elumeyjll)" height="52.9766" style="stroke: #A80036; stroke-width: 1.5;" width="105" x="371.5" y="748.1992"/><rect fill="#00FFFF" height="5" style="stroke: #A80036; stroke-width: 1.5;" width="10" x="366.5" y="753.1992"/><rect fill="#00FFFF" height="5" style="stroke: #A80036; stroke-width: 1.5;" width="10" x="366.5" y="791.1758"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="79" x="384.5" y="771.7344">«newclient»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="85" x="381.5" y="788.2227">IS API Server</text><!--MD5=[4815293e3103fd40b22d8b2760126ba0]
entity KS API Server--><rect fill="#00FFFF" filter="url(#fs97elumeyjll)" height="52.9766" style="stroke: #A80036; stroke-width: 1.5;" width="110" x="376" y="922.1992"/><rect fill="#00FFFF" height="5" style="stroke: #A80036; stroke-width: 1.5;" width="10" x="371" y="927.1992"/><rect fill="#00FFFF" height="5" style="stroke: #A80036; stroke-width: 1.5;" width="10" x="371" y="965.1758"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="79" x="391.5" y="945.7344">«newclient»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="386" y="962.2227">KS API Server</text><!--MD5=[e46db663c6807955aebb9f838b3ae64c]
entity CS API Server--><rect fill="#00FFFF" filter="url(#fs97elumeyjll)" height="52.9766" style="stroke: #A80036; stroke-width: 1.5;" width="111" x="581.5" y="922.1992"/><rect fill="#00FFFF" height="5" style="stroke: #A80036; stroke-width: 1.5;" width="10" x="576.5" y="927.1992"/><rect fill="#00FFFF" height="5" style="stroke: #A80036; stroke-width: 1.5;" width="10" x="576.5" y="965.1758"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="79" x="597.5" y="945.7344">«newclient»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="91" x="591.5" y="962.2227">CS API Server</text><!--MD5=[4a062c163a0ac5324e12d1af0fc147d0]
entity MR Client--><rect fill="#00FFFF" filter="url(#fs97elumeyjll)" height="52.9766" style="stroke: #A80036; stroke-width: 1.5;" width="99" x="589.5" y="574.1992"/><rect fill="#00FFFF" height="5" style="stroke: #A80036; stroke-width: 1.5;" width="10" x="584.5" y="579.1992"/><rect fill="#00FFFF" height="5" style="stroke: #A80036; stroke-width: 1.5;" width="10" x="584.5" y="617.1758"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="79" x="599.5" y="597.7344">«newclient»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="65" x="606.5" y="614.2227">MR Client</text><!--MD5=[3155f9bf23155fc869faccdedd826a7d]
entity MR API Server--><rect fill="#FFFFFF" filter="url(#fs97elumeyjll)" height="36.4883" style="stroke: #A80036; stroke-width: 1.5;" width="114" x="614" y="438.1992"/><rect fill="#FFFFFF" height="5" style="stroke: #A80036; stroke-width: 1.5;" width="10" x="609" y="443.1992"/><rect fill="#FFFFFF" height="5" style="stroke: #A80036; stroke-width: 1.5;" width="10" x="609" y="464.6875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="94" x="624" y="461.7344">MR API Server</text><!--MD5=[5ba7c1ccec5022ed021ea15342905256]
entity EA Runtime--><rect fill="#FFFFFF" filter="url(#fs97elumeyjll)" height="36.4883" style="stroke: #A80036; stroke-width: 1.5;" width="99" x="959.5" y="238.1992"/><rect fill="#FFFFFF" height="5" style="stroke: #A80036; stroke-width: 1.5;" width="10" x="954.5" y="243.1992"/><rect fill="#FFFFFF" height="5" style="stroke: #A80036; stroke-width: 1.5;" width="10" x="954.5" y="264.6875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="79" x="969.5" y="261.7344">EA Runtime</text><!--MD5=[5b83bafd7c74b83ec51e270621bf56a2]
entity MR EA Client--><rect fill="#FFFFFF" filter="url(#fs97elumeyjll)" height="36.4883" style="stroke: #A80036; stroke-width: 1.5;" width="107" x="817.5" y="238.1992"/><rect fill="#FFFFFF" height="5" style="stroke: #A80036; stroke-width: 1.5;" width="10" x="812.5" y="243.1992"/><rect fill="#FFFFFF" height="5" style="stroke: #A80036; stroke-width: 1.5;" width="10" x="812.5" y="264.6875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="87" x="827.5" y="261.7344">MR EA Client</text><!--MD5=[24ab2f0a2b55c39da5cc0c3d4d768f4c]
entity HLM Client--><rect fill="#00FFFF" filter="url(#fs97elumeyjll)" height="52.9766" style="stroke: #A80036; stroke-width: 1.5;" width="99" x="220.5" y="922.1992"/><rect fill="#00FFFF" height="5" style="stroke: #A80036; stroke-width: 1.5;" width="10" x="215.5" y="927.1992"/><rect fill="#00FFFF" height="5" style="stroke: #A80036; stroke-width: 1.5;" width="10" x="215.5" y="965.1758"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="79" x="230.5" y="945.7344">«newclient»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="73" x="233.5" y="962.2227">HLM Client</text><!--MD5=[c924f980343bd788827f783d5a7edfc1]
entity IoTHub HLM Client--><rect fill="#FFFFFF" filter="url(#fs97elumeyjll)" height="36.4883" style="stroke: #A80036; stroke-width: 1.5;" width="147" x="38.5" y="930.6992"/><rect fill="#FFFFFF" height="5" style="stroke: #A80036; stroke-width: 1.5;" width="10" x="33.5" y="935.6992"/><rect fill="#FFFFFF" height="5" style="stroke: #A80036; stroke-width: 1.5;" width="10" x="33.5" y="957.1875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="127" x="48.5" y="954.2344">IoTHub HLM Client</text><!--MD5=[aa4aa3311aae7e180c9897bde274b371]
entity MR EH Client--><rect fill="#FFFFFF" filter="url(#fs97elumeyjll)" height="36.4883" style="stroke: #A80036; stroke-width: 1.5;" width="107" x="653.5" y="238.1992"/><rect fill="#FFFFFF" height="5" style="stroke: #A80036; stroke-width: 1.5;" width="10" x="648.5" y="243.1992"/><rect fill="#FFFFFF" height="5" style="stroke: #A80036; stroke-width: 1.5;" width="10" x="648.5" y="264.6875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="87" x="663.5" y="261.7344">MR EH Client</text><!--MD5=[59f73ad67132c429e47a2962912cd517]
entity IoTHub EH Client--><rect fill="#FFFFFF" filter="url(#fs97elumeyjll)" height="36.4883" style="stroke: #A80036; stroke-width: 1.5;" width="136" x="482" y="238.1992"/><rect fill="#FFFFFF" height="5" style="stroke: #A80036; stroke-width: 1.5;" width="10" x="477" y="243.1992"/><rect fill="#FFFFFF" height="5" style="stroke: #A80036; stroke-width: 1.5;" width="10" x="477" y="264.6875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="116" x="492" y="261.7344">IoTHub EH Client</text><!--MD5=[ff028a7ac4eed75d9278e76cd9053439]
entity HSM--><path d="M406,1064.1992 C406,1054.1992 431,1054.1992 431,1054.1992 C431,1054.1992 456,1054.1992 456,1064.1992 L456,1089.6875 C456,1099.6875 431,1099.6875 431,1099.6875 C431,1099.6875 406,1099.6875 406,1089.6875 L406,1064.1992 " fill="#FEFECE" filter="url(#fs97elumeyjll)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M406,1064.1992 C406,1074.1992 431,1074.1992 431,1074.1992 C431,1074.1992 456,1074.1992 456,1064.1992 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="30" x="416" y="1091.7344">HSM</text><!--MD5=[b720394f0aae0190d443e5f6535e0772]
link MR Client to IS API Server--><path d="M589.45,614.0692 C560.75,623.0692 525.24,637.5292 499,659.1992 C471.23,682.1292 450.05,718.0492 437.4,743.5292 " fill="none" id="MR Client-&gt;IS API Server" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="435.13,748.1592,442.6844,741.8401,437.3317,743.6701,435.5017,738.3174,435.13,748.1592" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="20" x="500" y="672.7676">IPC</text><!--MD5=[57f1e3d6f07f345694d7571c09d91dd7]
link MR Client to CS API Server--><path d="M638.85,627.4192 C638.49,689.8492 637.57,849.1992 637.18,916.7192 " fill="none" id="MR Client-&gt;CS API Server" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="637.15,921.8092,641.2014,912.8322,637.1786,916.8093,633.2015,912.7865,637.15,921.8092" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="20" x="639" y="779.7676">IPC</text><!--MD5=[2cb1a7636232c972c79a6b42064c1ac8]
link MR Client to KS API Server--><path d="M623.54,627.4192 C585.93,689.9792 489.83,849.8392 449.38,917.1292 " fill="none" id="MR Client-&gt;KS API Server" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="446.57,921.8092,454.6304,916.1498,449.1425,917.5218,447.7705,912.0338,446.57,921.8092" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="20" x="589" y="779.7676">IPC</text><!--MD5=[bb8006141941b74a7f0945d98e4411d6]
reverse link IS API Server to HLM Client--><path d="M397.44,805.3592 C367.97,838.2792 320.9,890.8492 292.96,922.0592 " fill="none" id="IS API Server&lt;-HLM Client" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="400.94,801.4492,391.9547,805.4821,397.6031,805.1728,397.9124,810.8212,400.94,801.4492" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="20" x="370" y="846.7676">IPC</text><!--MD5=[da49a0e1aa8d83caf7bd9c54659dcd60]
reverse link KS API Server to HLM Client--><path d="M370.75,948.6992 C353.9,948.6992 335.78,948.6992 319.62,948.6992 " fill="none" id="KS API Server&lt;-HLM Client" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="375.93,948.6992,366.93,944.6992,370.93,948.6992,366.93,952.6992,375.93,948.6992" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="20" x="337.75" y="942.2676">IPC</text><!--MD5=[6804a73eee8e7028acdf854589507bfe]
link MR EH Client to MR API Server--><path d="M703.87,274.4192 C697.34,310.3492 682.26,393.2392 675.03,433.0592 " fill="none" id="MR EH Client-&gt;MR API Server" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="674.1,438.1592,679.6517,430.0242,674.9982,433.2406,671.7818,428.5871,674.1,438.1592" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="20" x="698" y="319.7676">IPC</text><!--MD5=[989b15a203ee7fd66555711c1bdf2e5d]
link MR EA Client to MR API Server--><path d="M853.6,274.4192 C816.87,310.7892 731.53,395.2792 691.9,434.4992 " fill="none" id="MR EA Client-&gt;MR API Server" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="688.22,438.1592,697.4336,434.6795,691.7769,434.6452,691.8112,428.9884,688.22,438.1592" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="20" x="818" y="319.7676">IPC</text><!--MD5=[5a3efcf7ab31a3b199e408c316a81fb1]
link MR API Server to MR Client--><path d="M667.14,474.3892 C661.88,497.8292 652.36,540.2092 645.86,569.1392 " fill="none" id="MR API Server-&gt;MR Client" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="644.77,574.0192,650.632,566.1049,645.8577,569.139,642.8236,564.3646,644.77,574.0192" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[f062dee797d7b0105199cffe6fb14117]
link IS API Server to KS API Server--><path d="M425.05,801.4492 C426.3,832.3192 428.41,883.9992 429.75,916.9392 " fill="none" id="IS API Server-&gt;KS API Server" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="429.96,922.0592,433.5971,912.9065,429.7602,917.0632,425.6035,913.2263,429.96,922.0592" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[e720ecd5333c3e6747c8d16060e24f97]
link IS API Server to CS API Server--><path d="M455.89,801.4492 C494.74,832.8292 560.23,885.6992 600.9,918.5492 " fill="none" id="IS API Server-&gt;CS API Server" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="605.24,922.0592,600.7422,913.2974,601.3468,918.9219,595.7224,919.5265,605.24,922.0592" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[be9537374aefee3a52829d99303fa4e2]
link KS API Server to HSM--><path d="M431,975.4992 C431,996.9592 431,1027.3992 431,1049.0892 " fill="none" id="KS API Server-&gt;HSM" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="431,1054.1192,435,1045.1192,431,1049.1192,427,1045.1192,431,1054.1192" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="432" y="1020.7676">libiothsm-keygen</text><!--MD5=[6437316005e372b013bcebfc39248628]
reverse link IoTHub Gateway to IS API Server--><path d="M458.88,138.2692 C445.81,167.5392 429,213.3092 429,255.1992 C429,255.1992 429,255.1992 429,601.6992 C429,653.6792 426.69,714.4592 425.21,748.0592 " fill="none" id="IoTHub Gateway&lt;-IS API Server" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="461.1,133.3592,453.7436,139.9078,459.0375,137.914,461.0312,143.2078,461.1,133.3592" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="40" x="430" y="461.2676">HTTPS</text><!--MD5=[847749b71113e909cc8a19318a9f9a5c]
reverse link DPS Gateway to IS API Server--><path d="M213.72,630.1792 C261.79,662.9792 340.06,716.4092 386.34,747.9992 " fill="none" id="DPS Gateway&lt;-IS API Server" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="209.45,627.2592,214.6336,635.6336,213.5814,630.0755,219.1396,629.0233,209.45,627.2592" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="40" x="277" y="672.7676">HTTPS</text><!--MD5=[0d641c891864d53fd7af52de3bfdc435]
reverse link PKI Service to IS API Server--><path d="M340.78,632.2892 C346.39,645.9692 353.51,662.1492 361,676.1992 C374.46,701.4492 392.37,728.6892 405.65,747.9392 " fill="none" id="PKI Service&lt;-IS API Server" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="338.78,627.3692,338.4713,637.2132,340.6665,631.9997,345.88,634.1949,338.78,627.3692" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="40" x="362" y="672.7676">HTTPS</text><!--MD5=[1ba61940d09e9bcc638ddaa746e5f6f8]
link IoTHub Gateway to IoTHub EH Client--><path d="M489.67,138.1092 C504.33,166.5692 525.88,208.3792 538.86,233.5792 " fill="none" id="IoTHub Gateway-IoTHub EH Client" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="541.18,238.0792,540.6324,228.2456,538.8984,233.6301,533.5139,231.8961,541.18,238.0792" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="487.24,133.3892,487.8004,143.2221,489.5274,137.8353,494.9142,139.5623,487.24,133.3892" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="513" y="178.7676">AMQP (EH Module)</text><!--MD5=[cbcbca9f985bb6aa0d9e9d43e5dd7433]
link IoTHub Gateway to IoTHub HLM Client--><path d="M403.14,118.3092 C286.05,137.8592 65,184.1692 65,255.1992 C65,255.1992 65,255.1992 65,775.6992 C65,831.2392 88.08,893.3992 101.89,925.6292 " fill="none" id="IoTHub Gateway-IoTHub HLM Client" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="104.03,930.5492,104.0985,920.7006,102.0312,925.9661,96.7656,923.8988,104.03,930.5492" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="408.29,117.4592,398.7583,114.9798,403.3569,118.2743,400.0624,122.8728,408.29,117.4592" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="66" y="519.7676">AMQP (HL Module)</text><!--MD5=[a20d16dcaadd67f259e89e744d6fba35]
reverse link IoTHub Gateway to EA Runtime--><path d="M544.9,107.4792 C640.27,109.9392 812.8,124.1892 942,190.1992 C964.37,201.6292 984.21,223.0492 996.39,238.1692 " fill="none" id="IoTHub Gateway&lt;-EA Runtime" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="539.86,107.3592,548.7542,111.5892,544.8583,107.4877,548.9598,103.5919,539.86,107.3592" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="40" x="920" y="178.7676">HTTPS</text><!--MD5=[2bb1165d97630197835da0f30dd2ce3e]
@startuml
title Data Flow - new architecture

cloud "DPS Service" {
    [DPS Gateway] <<service>>
}

cloud "PKI" {
    [PKI Service] <<service>>
}

cloud "IoT Hub Service" {
    [IoTHub Gateway] <<service>>
}

node "Identity Service" <<new>> {
    [IS API Server] <<newclient>>
}

node "Key Service" <<new>> {
    [KS API Server] <<newclient>>
    [KS API Server] <<newclient>>
}

node "Certificate Service" <<new>> {
    [CS API Server] <<newclient>>
}

node "Edge Module Runtime" <<modified>> {
    folder "MR Legacy Service" {
        [MR API Server]
    }
    [MR Client] <<newclient>>
}
node "Edge Agent" {
    [EA Runtime]
    [MR EA Client]
}
node "Host-level module" {
    [HLM Client] <<newclient>>
    [IoTHub HLM Client]
}
node "Edge Hub" {
    [MR EH Client]
    [IoTHub EH Client]
}

database "HSM"

[MR Client] -down-> [IS API Server] : IPC
[MR Client] -down-> [CS API Server] : IPC
[MR Client] -down-> [KS API Server] : IPC
[HLM Client] -left-> [IS API Server] : IPC
[HLM Client] -left-> [KS API Server] : IPC
[MR EH Client] - -> [MR API Server] : IPC
[MR EA Client] - -> [MR API Server] : IPC

[MR API Server] - -> [MR Client]
[IS API Server] -down-> [KS API Server]
[IS API Server] -down-> [CS API Server]
[KS API Server] -down-> HSM : libiothsm-keygen

[IS API Server] -up-> [IoTHub Gateway] : HTTPS
[IS API Server] -up-> [DPS Gateway] : HTTPS
[IS API Server] -up-> [PKI Service] : HTTPS

[IoTHub EH Client] <-up-> [IoTHub Gateway] : AMQP (EH Module)
[IoTHub HLM Client] <-up-> [IoTHub Gateway] : AMQP (HL Module)

[EA Runtime] -up-> [IoTHub Gateway] : HTTPS

skinparam node {
	backgroundColor<<new>> Magenta
	backgroundColor<<modified>> Yellow
}

skinparam component {
    backgroundColor White
    backgroundColor<<newclient>> Cyan
    backgroundColor<<modified>> Yellow
    backgroundColor<<service>> White
}

@enduml

PlantUML version 1.2020.10(Sun May 17 02:35:57 PDT 2020)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 13.0.1+9
Operating System: Mac OS X
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>