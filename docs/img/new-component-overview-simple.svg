<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1157px" preserveAspectRatio="none" style="width:1169px;height:1157px;" version="1.1" viewBox="0 0 1169 1157" width="1169px" zoomAndPan="magnify"><defs><filter height="300%" id="f1hlcc6bvydbtp" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="231" x="460" y="16.6992">Data Flow - new architecture</text><!--MD5=[4034dc877b8eccbaf2b7bb77a2a7acd3]
cluster DPS Service--><path d="M98.6074,564.832 C101.2647,556.2389 107.5479,555.9756 112.9157,562.2177 C116.1876,556.2533 121.8223,555.3118 125.6214,561.6742 C128.5427,555.2082 132.9819,554.3802 137.3873,560.2598 C140.4021,552.9372 147.4224,551.8325 151.6433,559.0797 C153.9246,552.1496 160.1798,551.1612 164.6038,556.8851 C168.9087,551.8556 174.6527,551.1388 177.3979,558.4961 C182.1767,553.9698 186.9346,555.012 189.4613,561.0643 C194.1357,555.1388 198.2107,554.0001 202.6644,561.2849 C207.6171,554.9478 213.8794,556.8041 216.9338,563.3822 C225.9138,557.8039 232.1163,559.8589 235,570.2702 C236.0186,570.1584 236.5636,570.9304 236.1146,571.8524 C242.5662,576.5494 242.0038,580.8645 235.5703,585.0293 C243.3441,588.4487 243.6121,594.0908 237.3503,599.2652 C244.8201,603.4 243.5587,608.7499 237.8924,613.389 C244.6074,618.596 244.0493,623.3697 237.3739,628.1049 C244.1393,632.9602 242.4336,637.7227 236.4356,641.6969 C242.425,650.9569 239.1801,659.4098 228,661.2702 C229.3538,661.0119 230.4677,661.6008 229.9512,663.217 C226.5194,670.053 220.095,669.6222 215.9319,664.0427 C211.9708,670.9247 208.0076,671.8709 202.6267,665.4644 C200.242,672.2906 194.7474,673.9655 189.199,669.0967 C186.6072,674.2337 181.4514,674.7133 178.0423,670.0247 C175.0329,676.6561 170.1527,678.6784 164.6141,672.723 C159.2278,678.1695 154.5065,675.751 151.8996,669.6601 C147.073,675.958 141.5768,674.7211 137.6975,668.5786 C132.2543,674.5616 127.8699,673.3913 124.19,666.6994 C119.2678,671.9541 113.852,670.6435 112.2925,663.4782 C100.5925,671.2569 93.9366,666.756 91,654.2702 C91.4784,653.6651 91.973,653.7108 92.3427,654.3843 C86.6911,651.758 84.189,646.9486 89.9632,642.1077 C82.8799,638.2346 82.4495,632.1719 88.0865,626.7449 C81.9865,622.0844 80.0692,617.4398 87.5797,612.3017 C81.9449,606.9321 82.0133,601.6908 89.6864,598.3275 C82.9929,593.1508 84.2062,588.8187 90.5647,584.4692 C82.8195,575.1531 85.9245,565.6345 98,563.2702 C98.8776,563.4819 99.1945,564.0507 98.6074,564.832 " fill="#FFFFFF" filter="url(#f1hlcc6bvydbtp)" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="81" x="122.5" y="581.2585">DPS Service</text><!--MD5=[9cc3614b0e94473f1fa5351936eadb26]
cluster PKI--><path d="M283.9369,564.3094 C286.6278,560.0987 290.4758,559.8477 293.5291,563.8881 C296.0513,557.7588 300.9789,558.7276 304.5006,562.8147 C307.2782,557.0482 312.675,554.5812 317.2083,560.9809 C319.4274,554.6338 324.2517,554.4906 328.7181,558.4779 C330.7937,553.7992 336.0556,552.5831 339.4066,556.975 C343.2711,553.137 348.2809,554.125 349.4574,559.8115 C353.8846,553.7913 357.5948,553.9798 361.4559,560.3593 C365.7991,555.0605 370.6229,555.0666 373.6638,561.6926 C377.0142,557.2826 381.2875,558.5444 383.2479,563.1673 C390.9988,557.0212 399.5001,560.7935 401,570.2702 C402.3225,569.8167 402.8179,570.3254 402.8727,571.6246 C409.9078,574.0693 409.85,579.6935 405.1848,584.2764 C412.6448,588.1676 413.6734,594.9136 406.9434,600.3567 C414.1204,601.5743 415.1807,607.5365 410.8872,612.4842 C416.6431,618.925 415.9011,625.9041 406.6364,628.3106 C412.2154,632.7173 411.9757,638.4244 404.9124,641.1311 C410.4387,651.7383 407.2164,660.8187 394,661.2702 C394.7238,661.0292 395.0229,661.4193 394.9423,662.0961 C391.8531,667.4761 387.4711,667.6491 384.5488,661.9396 C382.0545,668.3938 377.2013,668.517 372.7362,664.0765 C368.3393,670.0984 364.2885,668.9945 360.9424,663.0417 C358.0795,668.7599 353.4392,669.0426 350.0569,663.5458 C346.7838,668.4988 343.1781,668.3955 339.9312,663.5188 C335.8022,669.9229 331.7394,669.0745 327.9045,663.2301 C323.7686,668.327 319.3798,669.0751 315.7486,662.6955 C312.9952,667.6589 309.2891,666.9624 306.4689,662.7631 C302.1438,667.7957 298.476,668.3706 294.6795,662.2066 C285.1647,667.6712 277.2992,666.6977 275,654.2702 C276.0535,653.4301 277.0066,653.8937 277.0381,655.2281 C270.0583,653.2818 267.1776,646.5115 272.8708,640.8835 C265.3918,639.1135 264.2698,633.3578 269.2349,628.0595 C261.2701,624.8098 260.7872,618.7753 265.9339,612.7066 C259.9567,607.2082 260.8119,600.8546 269.2588,598.8066 C263.2823,592.9557 265.3963,586.5085 273.5374,585.0479 C267.0252,574.0446 268.9071,566.6552 282,563.2702 C283.0441,562.4986 283.9068,563.1912 283.9369,564.3094 " fill="#FFFFFF" filter="url(#f1hlcc6bvydbtp)" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="22" x="327" y="581.2585">PKI</text><!--MD5=[4b6597e5202bb255e27abc7ed2ac90aa]
cluster IoT Hub Service--><path d="M419.0135,39.8408 C422.6562,33.4701 426.8849,33.7862 431.5135,38.754 C434.6152,32.0986 440.5204,30.844 444.8699,37.5024 C449.1488,32.2495 452.6503,31.5488 456.4151,38.0092 C459.8941,31.6541 463.7172,29.0399 469.7913,35.2456 C473.4261,28.5294 477.49,29.4092 481.8651,34.4878 C485.4056,28.6882 489.8696,28.3541 493.5937,34.3045 C497.2795,27.7671 503.2381,27.0938 507.4309,33.7737 C512.1912,28.5141 517.412,29.3506 519.8854,36.1379 C523.3585,30.4319 528.6037,30.5249 531.9467,36.2749 C535.1736,32.2834 540.325,32.2431 542.4668,37.5081 C547.008,31.9988 551.9608,31.8041 554.8865,39.0777 C564.2434,33.5799 571.2919,34.0995 574,46.2702 C575.0309,46.0479 575.5778,46.7518 575.3461,47.71 C582.2632,51.8991 582.1959,56.7014 575.1608,60.6913 C581.7462,64.4336 582.9791,69.2462 576.5081,74.2828 C584.2712,78.398 583.8945,83.5632 577.1709,88.3605 C584.6901,93.1702 584.1243,99.827 576.3063,103.7765 C582.1237,108.1584 581.5293,112.4981 576.0129,116.6212 C583.6361,127.4503 578.632,134.8456 567,137.2702 C567.4498,137.2926 567.5723,137.5761 567.37,137.9523 C564.0337,143.4877 558.9182,144.8487 555.0526,138.501 C553.4449,144.1366 548.079,144.8749 544.1885,141.1505 C540.3385,146.6939 534.683,147.6116 530.776,141.2145 C527.9466,146.7673 523.1496,146.122 519.8638,141.7145 C517.1048,148.8174 510.0907,149.3524 505.7475,143.4316 C502.3819,149.9498 497.408,149.6732 493.1158,144.4267 C488.744,150.9136 484.6128,150.0999 480.7222,143.9545 C476.2484,148.7394 472.3004,148.349 469.7643,142.0404 C465.5202,148.8139 459.1821,147.658 456.4591,140.5794 C452.8265,145.3903 449.1643,146.0305 445.6708,140.4352 C440.8939,147.1024 435.5037,146.1377 431.4653,139.6384 C421.9928,146.4248 412.135,142.8856 412,130.2702 C413.1859,129.8275 413.9467,130.5345 413.7813,131.7351 C406.8674,127.2913 406.5344,122.6981 412.1399,116.8719 C404.4504,113.3614 402.7984,108.4831 409.4635,102.3306 C402.4192,99.2964 401.0624,95.4426 407.077,89.9011 C401.2153,84.6961 402.2744,78.0336 409.3477,74.7698 C405.1515,70.3909 404.7339,64.1158 412.2322,62.482 C405.0983,52.2439 406.9408,43.9123 419,39.2702 C419.2666,39.42 419.3005,39.678 419.0135,39.8408 " fill="#FFFFFF" filter="url(#f1hlcc6bvydbtp)" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="105" x="440.5" y="57.2585">IoT Hub Service</text><!--MD5=[7794c020febe37fee2610325f7805d30]
cluster Identity Service--><polygon fill="#FF00FF" filter="url(#f1hlcc6bvydbtp)" points="337,728.2702,347,718.2702,518,718.2702,518,843.2702,508,853.2702,337,853.2702,337,728.2702" style="stroke: #000000; stroke-width: 1.5;"/><line style="stroke: #000000; stroke-width: 1.5;" x1="508" x2="518" y1="728.2702" y2="718.2702"/><line style="stroke: #000000; stroke-width: 1.5;" x1="337" x2="508" y1="728.2702" y2="728.2702"/><line style="stroke: #000000; stroke-width: 1.5;" x1="508" x2="508" y1="728.2702" y2="853.2702"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="37" x="405" y="744.2585">«new»</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="105" x="371" y="760.6648">Identity Service</text><!--MD5=[9e5069793647d3bf2dd98c06c7283a6f]
cluster Key Service--><polygon fill="#FF00FF" filter="url(#f1hlcc6bvydbtp)" points="374,912.2702,384,902.2702,532,902.2702,532,1027.2702,522,1037.2702,374,1037.2702,374,912.2702" style="stroke: #000000; stroke-width: 1.5;"/><line style="stroke: #000000; stroke-width: 1.5;" x1="522" x2="532" y1="912.2702" y2="902.2702"/><line style="stroke: #000000; stroke-width: 1.5;" x1="374" x2="522" y1="912.2702" y2="912.2702"/><line style="stroke: #000000; stroke-width: 1.5;" x1="522" x2="522" y1="912.2702" y2="1037.2702"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="37" x="430.5" y="928.2585">«new»</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="77" x="410.5" y="944.6648">Key Service</text><!--MD5=[4e0ace6db1f04dc49a616f890a95ce58]
cluster Certificate Service--><polygon fill="#FF00FF" filter="url(#f1hlcc6bvydbtp)" points="559,912.2702,569,902.2702,762,902.2702,762,1027.2702,752,1037.2702,559,1037.2702,559,912.2702" style="stroke: #000000; stroke-width: 1.5;"/><line style="stroke: #000000; stroke-width: 1.5;" x1="752" x2="762" y1="912.2702" y2="902.2702"/><line style="stroke: #000000; stroke-width: 1.5;" x1="559" x2="752" y1="912.2702" y2="912.2702"/><line style="stroke: #000000; stroke-width: 1.5;" x1="752" x2="752" y1="912.2702" y2="1037.2702"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="37" x="638" y="928.2585">«new»</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="127" x="593" y="944.6648">Certificate Service</text><!--MD5=[8ff2ff8eaa8b0e22a01544f4bdf4d05f]
cluster Edge Module Runtime--><polygon fill="#FFFF00" filter="url(#f1hlcc6bvydbtp)" points="583,355.2702,593,345.2702,804,345.2702,804,659.2702,794,669.2702,583,669.2702,583,355.2702" style="stroke: #000000; stroke-width: 1.5;"/><line style="stroke: #000000; stroke-width: 1.5;" x1="794" x2="804" y1="355.2702" y2="345.2702"/><line style="stroke: #000000; stroke-width: 1.5;" x1="583" x2="794" y1="355.2702" y2="355.2702"/><line style="stroke: #000000; stroke-width: 1.5;" x1="794" x2="794" y1="355.2702" y2="669.2702"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="66" x="656.5" y="371.2585">«modified»</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="145" x="617" y="387.6648">Edge Module Runtime</text><!--MD5=[7cbe1a5fc3e046c9a58895a21185779e]
cluster MR Legacy Service--><polygon fill="#FFFF00" filter="url(#f1hlcc6bvydbtp)" points="613,409.2702,744,409.2702,751,431.6765,775,431.6765,775,506.2702,613,506.2702,613,409.2702" style="stroke: #000000; stroke-width: 1.5;"/><line style="stroke: #000000; stroke-width: 1.5;" x1="613" x2="751" y1="431.6765" y2="431.6765"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="125" x="617" y="424.2585">MR Legacy Service</text><!--MD5=[9b13154502175b34a7dde17b32f1f8a1]
cluster Edge Agent--><polygon fill="#FFFFFF" filter="url(#f1hlcc6bvydbtp)" points="843,204.2702,853,194.2702,1147,194.2702,1147,286.2702,1137,296.2702,843,296.2702,843,204.2702" style="stroke: #000000; stroke-width: 1.5;"/><line style="stroke: #000000; stroke-width: 1.5;" x1="1137" x2="1147" y1="204.2702" y2="194.2702"/><line style="stroke: #000000; stroke-width: 1.5;" x1="843" x2="1137" y1="204.2702" y2="204.2702"/><line style="stroke: #000000; stroke-width: 1.5;" x1="1137" x2="1137" y1="204.2702" y2="296.2702"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="77" x="952.5" y="220.2585">Edge Agent</text><!--MD5=[7d68aa027216ad083fcdb57666e906fc]
cluster Host-level module--><polygon fill="#FFFFFF" filter="url(#f1hlcc6bvydbtp)" points="16,928.2702,26,918.2702,350,918.2702,350,1027.2702,340,1037.2702,16,1037.2702,16,928.2702" style="stroke: #000000; stroke-width: 1.5;"/><line style="stroke: #000000; stroke-width: 1.5;" x1="340" x2="350" y1="928.2702" y2="918.2702"/><line style="stroke: #000000; stroke-width: 1.5;" x1="16" x2="340" y1="928.2702" y2="928.2702"/><line style="stroke: #000000; stroke-width: 1.5;" x1="340" x2="340" y1="928.2702" y2="1037.2702"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="123" x="117.5" y="944.2585">Host-level module</text><!--MD5=[b606e694e189a5e0bde06dd1b8d0f0e0]
cluster Edge Hub--><polygon fill="#FFFFFF" filter="url(#f1hlcc6bvydbtp)" points="484,204.2702,494,194.2702,819,194.2702,819,286.2702,809,296.2702,484,296.2702,484,204.2702" style="stroke: #000000; stroke-width: 1.5;"/><line style="stroke: #000000; stroke-width: 1.5;" x1="809" x2="819" y1="204.2702" y2="194.2702"/><line style="stroke: #000000; stroke-width: 1.5;" x1="484" x2="809" y1="204.2702" y2="204.2702"/><line style="stroke: #000000; stroke-width: 1.5;" x1="809" x2="809" y1="204.2702" y2="296.2702"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="63" x="616" y="220.2585">Edge Hub</text><!--MD5=[e8cfd881e0c7b95e10a1bb0d559cc9f2]
entity DPS Gateway--><rect fill="#FFFFFF" filter="url(#f1hlcc6bvydbtp)" height="62.8125" style="stroke: #A80036; stroke-width: 1.5;" width="127" x="99.5" y="590.2702"/><rect fill="#FFFFFF" height="10" style="stroke: #A80036; stroke-width: 1.5;" width="15" x="206.5" y="595.2702"/><rect fill="#FFFFFF" height="2" style="stroke: #A80036; stroke-width: 1.5;" width="4" x="204.5" y="597.2702"/><rect fill="#FFFFFF" height="2" style="stroke: #A80036; stroke-width: 1.5;" width="4" x="204.5" y="601.2702"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="55" x="130.5" y="623.2585">«service»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="87" x="114.5" y="639.6648">DPS Gateway</text><!--MD5=[344739cc555d75ba553dad245e8ebc3e]
entity PKI Service--><rect fill="#FFFFFF" filter="url(#f1hlcc6bvydbtp)" height="62.8125" style="stroke: #A80036; stroke-width: 1.5;" width="111" x="282.5" y="590.2702"/><rect fill="#FFFFFF" height="10" style="stroke: #A80036; stroke-width: 1.5;" width="15" x="373.5" y="595.2702"/><rect fill="#FFFFFF" height="2" style="stroke: #A80036; stroke-width: 1.5;" width="4" x="371.5" y="597.2702"/><rect fill="#FFFFFF" height="2" style="stroke: #A80036; stroke-width: 1.5;" width="4" x="371.5" y="601.2702"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="55" x="305.5" y="623.2585">«service»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="71" x="297.5" y="639.6648">PKI Service</text><!--MD5=[90fbbf7b6c870618297b0507f9a7a4e4]
entity IoTHub Gateway--><rect fill="#FFFFFF" filter="url(#f1hlcc6bvydbtp)" height="62.8125" style="stroke: #A80036; stroke-width: 1.5;" width="146" x="420" y="66.2702"/><rect fill="#FFFFFF" height="10" style="stroke: #A80036; stroke-width: 1.5;" width="15" x="546" y="71.2702"/><rect fill="#FFFFFF" height="2" style="stroke: #A80036; stroke-width: 1.5;" width="4" x="544" y="73.2702"/><rect fill="#FFFFFF" height="2" style="stroke: #A80036; stroke-width: 1.5;" width="4" x="544" y="77.2702"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="55" x="460.5" y="99.2585">«service»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="106" x="435" y="115.6648">IoTHub Gateway</text><!--MD5=[084e4c2da341887b8d9e91d65abc0526]
entity IS API Server--><rect fill="#00FFFF" filter="url(#f1hlcc6bvydbtp)" height="62.8125" style="stroke: #A80036; stroke-width: 1.5;" width="121" x="378.5" y="774.2702"/><rect fill="#00FFFF" height="10" style="stroke: #A80036; stroke-width: 1.5;" width="15" x="479.5" y="779.2702"/><rect fill="#00FFFF" height="2" style="stroke: #A80036; stroke-width: 1.5;" width="4" x="477.5" y="781.2702"/><rect fill="#00FFFF" height="2" style="stroke: #A80036; stroke-width: 1.5;" width="4" x="477.5" y="785.2702"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="69" x="399.5" y="807.2585">«newclient»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="81" x="393.5" y="823.6648">IS API Server</text><!--MD5=[4815293e3103fd40b22d8b2760126ba0]
entity KS API Server--><rect fill="#00FFFF" filter="url(#f1hlcc6bvydbtp)" height="62.8125" style="stroke: #A80036; stroke-width: 1.5;" width="126" x="390" y="958.2702"/><rect fill="#00FFFF" height="10" style="stroke: #A80036; stroke-width: 1.5;" width="15" x="496" y="963.2702"/><rect fill="#00FFFF" height="2" style="stroke: #A80036; stroke-width: 1.5;" width="4" x="494" y="965.2702"/><rect fill="#00FFFF" height="2" style="stroke: #A80036; stroke-width: 1.5;" width="4" x="494" y="969.2702"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="69" x="413.5" y="991.2585">«newclient»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="86" x="405" y="1007.6648">KS API Server</text><!--MD5=[e46db663c6807955aebb9f838b3ae64c]
entity CS API Server--><rect fill="#00FFFF" filter="url(#f1hlcc6bvydbtp)" height="62.8125" style="stroke: #A80036; stroke-width: 1.5;" width="127" x="594.5" y="958.2702"/><rect fill="#00FFFF" height="10" style="stroke: #A80036; stroke-width: 1.5;" width="15" x="701.5" y="963.2702"/><rect fill="#00FFFF" height="2" style="stroke: #A80036; stroke-width: 1.5;" width="4" x="699.5" y="965.2702"/><rect fill="#00FFFF" height="2" style="stroke: #A80036; stroke-width: 1.5;" width="4" x="699.5" y="969.2702"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="69" x="618.5" y="991.2585">«newclient»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="87" x="609.5" y="1007.6648">CS API Server</text><!--MD5=[4a062c163a0ac5324e12d1af0fc147d0]
entity MR Client--><rect fill="#00FFFF" filter="url(#f1hlcc6bvydbtp)" height="62.8125" style="stroke: #A80036; stroke-width: 1.5;" width="109" x="605.5" y="590.2702"/><rect fill="#00FFFF" height="10" style="stroke: #A80036; stroke-width: 1.5;" width="15" x="694.5" y="595.2702"/><rect fill="#00FFFF" height="2" style="stroke: #A80036; stroke-width: 1.5;" width="4" x="692.5" y="597.2702"/><rect fill="#00FFFF" height="2" style="stroke: #A80036; stroke-width: 1.5;" width="4" x="692.5" y="601.2702"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="69" x="620.5" y="623.2585">«newclient»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="61" x="624.5" y="639.6648">MR Client</text><!--MD5=[3155f9bf23155fc869faccdedd826a7d]
entity MR API Server--><rect fill="#FFFFFF" filter="url(#f1hlcc6bvydbtp)" height="46.4063" style="stroke: #A80036; stroke-width: 1.5;" width="130" x="629" y="444.2702"/><rect fill="#FFFFFF" height="10" style="stroke: #A80036; stroke-width: 1.5;" width="15" x="739" y="449.2702"/><rect fill="#FFFFFF" height="2" style="stroke: #A80036; stroke-width: 1.5;" width="4" x="737" y="451.2702"/><rect fill="#FFFFFF" height="2" style="stroke: #A80036; stroke-width: 1.5;" width="4" x="737" y="455.2702"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="644" y="477.2585">MR API Server</text><!--MD5=[5ba7c1ccec5022ed021ea15342905256]
entity EA Runtime--><rect fill="#FFFFFF" filter="url(#f1hlcc6bvydbtp)" height="46.4063" style="stroke: #A80036; stroke-width: 1.5;" width="115" x="1015.5" y="234.2702"/><rect fill="#FFFFFF" height="10" style="stroke: #A80036; stroke-width: 1.5;" width="15" x="1110.5" y="239.2702"/><rect fill="#FFFFFF" height="2" style="stroke: #A80036; stroke-width: 1.5;" width="4" x="1108.5" y="241.2702"/><rect fill="#FFFFFF" height="2" style="stroke: #A80036; stroke-width: 1.5;" width="4" x="1108.5" y="245.2702"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="75" x="1030.5" y="267.2585">EA Runtime</text><!--MD5=[5b83bafd7c74b83ec51e270621bf56a2]
entity MR EA Client--><rect fill="#FFFFFF" filter="url(#f1hlcc6bvydbtp)" height="46.4063" style="stroke: #A80036; stroke-width: 1.5;" width="121" x="859.5" y="234.2702"/><rect fill="#FFFFFF" height="10" style="stroke: #A80036; stroke-width: 1.5;" width="15" x="960.5" y="239.2702"/><rect fill="#FFFFFF" height="2" style="stroke: #A80036; stroke-width: 1.5;" width="4" x="958.5" y="241.2702"/><rect fill="#FFFFFF" height="2" style="stroke: #A80036; stroke-width: 1.5;" width="4" x="958.5" y="245.2702"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="81" x="874.5" y="267.2585">MR EA Client</text><!--MD5=[24ab2f0a2b55c39da5cc0c3d4d768f4c]
entity HLM Client--><rect fill="#00FFFF" filter="url(#f1hlcc6bvydbtp)" height="62.8125" style="stroke: #A80036; stroke-width: 1.5;" width="109" x="224.5" y="958.2702"/><rect fill="#00FFFF" height="10" style="stroke: #A80036; stroke-width: 1.5;" width="15" x="313.5" y="963.2702"/><rect fill="#00FFFF" height="2" style="stroke: #A80036; stroke-width: 1.5;" width="4" x="311.5" y="965.2702"/><rect fill="#00FFFF" height="2" style="stroke: #A80036; stroke-width: 1.5;" width="4" x="311.5" y="969.2702"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="69" x="239.5" y="991.2585">«newclient»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="68" x="240" y="1007.6648">HLM Client</text><!--MD5=[c924f980343bd788827f783d5a7edfc1]
entity IoTHub HLM Client--><rect fill="#FFFFFF" filter="url(#f1hlcc6bvydbtp)" height="46.4063" style="stroke: #A80036; stroke-width: 1.5;" width="157" x="32.5" y="966.7702"/><rect fill="#FFFFFF" height="10" style="stroke: #A80036; stroke-width: 1.5;" width="15" x="169.5" y="971.7702"/><rect fill="#FFFFFF" height="2" style="stroke: #A80036; stroke-width: 1.5;" width="4" x="167.5" y="973.7702"/><rect fill="#FFFFFF" height="2" style="stroke: #A80036; stroke-width: 1.5;" width="4" x="167.5" y="977.7702"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="117" x="47.5" y="999.7585">IoTHub HLM Client</text><!--MD5=[aa4aa3311aae7e180c9897bde274b371]
entity MR EH Client--><rect fill="#FFFFFF" filter="url(#f1hlcc6bvydbtp)" height="46.4063" style="stroke: #A80036; stroke-width: 1.5;" width="121" x="681.5" y="234.2702"/><rect fill="#FFFFFF" height="10" style="stroke: #A80036; stroke-width: 1.5;" width="15" x="782.5" y="239.2702"/><rect fill="#FFFFFF" height="2" style="stroke: #A80036; stroke-width: 1.5;" width="4" x="780.5" y="241.2702"/><rect fill="#FFFFFF" height="2" style="stroke: #A80036; stroke-width: 1.5;" width="4" x="780.5" y="245.2702"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="81" x="696.5" y="267.2585">MR EH Client</text><!--MD5=[59f73ad67132c429e47a2962912cd517]
entity IoTHub EH Client--><rect fill="#FFFFFF" filter="url(#f1hlcc6bvydbtp)" height="46.4063" style="stroke: #A80036; stroke-width: 1.5;" width="146" x="500" y="234.2702"/><rect fill="#FFFFFF" height="10" style="stroke: #A80036; stroke-width: 1.5;" width="15" x="626" y="239.2702"/><rect fill="#FFFFFF" height="2" style="stroke: #A80036; stroke-width: 1.5;" width="4" x="624" y="241.2702"/><rect fill="#FFFFFF" height="2" style="stroke: #A80036; stroke-width: 1.5;" width="4" x="624" y="245.2702"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="106" x="515" y="267.2585">IoTHub EH Client</text><!--MD5=[ff028a7ac4eed75d9278e76cd9053439]
entity HSM--><path d="M428,1110.2702 C428,1100.2702 453,1100.2702 453,1100.2702 C453,1100.2702 478,1100.2702 478,1110.2702 L478,1135.6765 C478,1145.6765 453,1145.6765 453,1145.6765 C453,1145.6765 428,1145.6765 428,1135.6765 L428,1110.2702 " fill="#FEFECE" filter="url(#f1hlcc6bvydbtp)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M428,1110.2702 C428,1120.2702 453,1120.2702 453,1120.2702 C453,1120.2702 478,1120.2702 478,1110.2702 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="30" x="438" y="1137.2585">HSM</text><!--MD5=[b720394f0aae0190d443e5f6535e0772]
link MR Client to IS API Server--><path d="M605.3,640.3702 C578.88,650.6602 547.82,665.5502 524,685.2702 C495.73,708.6802 472.35,743.6202 457.31,769.6802 " fill="none" id="MR Client-to-IS API Server" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="454.78,774.1102,462.7079,768.2665,457.253,769.7646,455.7549,764.3097,454.78,774.1102" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="18" x="525" y="698.3308">IPC</text><!--MD5=[57f1e3d6f07f345694d7571c09d91dd7]
link MR Client to CS API Server--><path d="M659.83,653.3502 C659.47,720.6202 658.59,881.2102 658.2,953.0102 " fill="none" id="MR Client-to-CS API Server" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="658.17,958.0202,662.2214,949.0432,658.1986,953.0203,654.2215,948.9975,658.17,958.0202" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="18" x="660" y="810.3308">IPC</text><!--MD5=[2cb1a7636232c972c79a6b42064c1ac8]
link MR Client to KS API Server--><path d="M642.71,653.3502 C604.58,720.7602 513.47,881.8502 472.98,953.4402 " fill="none" id="MR Client-to-KS API Server" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="470.39,958.0202,478.3033,952.1568,472.8522,953.6685,471.3405,948.2173,470.39,958.0202" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="18" x="610" y="810.3308">IPC</text><!--MD5=[bb8006141941b74a7f0945d98e4411d6]
reverse link IS API Server to HLM Client--><path d="M408.32,841.6702 C378.71,875.3502 334.32,925.8502 306.01,958.0502 " fill="none" id="IS API Server-backto-HLM Client" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="411.86,837.6402,402.9154,841.7626,408.5604,841.3969,408.9261,847.0419,411.86,837.6402" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="18" x="383" y="882.3308">IPC</text><!--MD5=[da49a0e1aa8d83caf7bd9c54659dcd60]
reverse link KS API Server to HLM Client--><path d="M384.58,989.7702 C367.66,989.7702 349.74,989.7702 333.58,989.7702 " fill="none" id="KS API Server-backto-HLM Client" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="389.8,989.7702,380.8,985.7702,384.8,989.7702,380.8,993.7702,389.8,989.7702" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="18" x="352.75" y="982.8308">IPC</text><!--MD5=[6804a73eee8e7028acdf854589507bfe]
link MR EH Client to MR API Server--><path d="M736.86,280.5302 C727.99,319.0002 709.81,397.7802 700.22,439.3002 " fill="none" id="MR EH Client-to-MR API Server" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="699.1,444.1702,705.028,436.3052,700.2285,439.2992,697.2345,434.4997,699.1,444.1702" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="18" x="730" y="325.3308">IPC</text><!--MD5=[989b15a203ee7fd66555711c1bdf2e5d]
link MR EA Client to MR API Server--><path d="M895.81,280.5302 C853.59,319.3902 766.67,399.3902 721.94,440.5502 " fill="none" id="MR EA Client-to-MR API Server" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="718.01,444.1702,727.3379,441.0094,721.6857,440.7806,721.9145,435.1284,718.01,444.1702" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="18" x="860" y="325.3308">IPC</text><!--MD5=[5a3efcf7ab31a3b199e408c316a81fb1]
link MR API Server to MR Client--><path d="M689.06,490.4402 C683.52,515.2802 674.47,555.8802 667.94,585.1702 " fill="none" id="MR API Server-to-MR Client" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="666.83,590.1302,672.6871,582.2123,667.9147,585.2493,664.8776,580.4768,666.83,590.1302" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[f062dee797d7b0105199cffe6fb14117]
link IS API Server to KS API Server--><path d="M441.37,837.6402 C443.83,869.5102 447.65,919.1802 450.23,952.8002 " fill="none" id="IS API Server-to-KS API Server" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="450.64,958.0502,453.9339,948.7685,450.2543,953.0651,445.9577,949.3856,450.64,958.0502" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[e720ecd5333c3e6747c8d16060e24f97]
link IS API Server to CS API Server--><path d="M476.15,837.6402 C515.28,870.1602 576.73,921.2302 617.18,954.8502 " fill="none" id="IS API Server-to-CS API Server" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="621.03,958.0502,616.6735,949.2173,617.1877,954.8507,611.5543,955.3649,621.03,958.0502" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[be9537374aefee3a52829d99303fa4e2]
link KS API Server to HSM--><path d="M453,1021.4802 C453,1043.7902 453,1073.6902 453,1095.0202 " fill="none" id="KS API Server-to-HSM" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="453,1100.2502,457,1091.2502,453,1095.2502,449,1091.2502,453,1100.2502" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="74" x="454" y="1066.3308">libaziot-keys</text><!--MD5=[6437316005e372b013bcebfc39248628]
reverse link IoTHub Gateway to IS API Server--><path d="M476.36,134.2702 C463.19,165.6402 447,213.0102 447,256.2702 C447,256.2702 447,256.2702 447,622.7702 C447,676.0602 443.53,738.0502 441.16,774.2002 " fill="none" id="IoTHub Gateway-backto-IS API Server" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="478.45,129.3802,471.2458,136.0958,476.4925,133.9811,478.6072,139.2278,478.45,129.3802" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="448" y="471.8308">HTTPS</text><!--MD5=[847749b71113e909cc8a19318a9f9a5c]
reverse link DPS Gateway to IS API Server--><path d="M213.75,656.2302 C264.77,689.8802 342.77,741.3102 392.3,773.9802 " fill="none" id="DPS Gateway-backto-IS API Server" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="209.51,653.4402,214.8126,661.7398,213.6812,656.1972,219.2238,655.0659,209.51,653.4402" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="278" y="698.3308">HTTPS</text><!--MD5=[0d641c891864d53fd7af52de3bfdc435]
reverse link PKI Service to IS API Server--><path d="M353.86,657.9902 C360.4,671.9502 368.25,688.0302 376,702.2702 C389.38,726.8502 406.02,753.7802 418.83,773.8702 " fill="none" id="PKI Service-backto-IS API Server" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="351.7,653.3502,351.8711,663.1976,353.8097,657.8833,359.124,659.822,351.7,653.3502" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="377" y="698.3308">HTTPS</text><!--MD5=[1ba61940d09e9bcc638ddaa746e5f6f8]
link IoTHub Gateway to IoTHub EH Client--><path d="M511.06,134.3202 C525.72,163.2002 546.09,203.2902 559.4,229.5002 " fill="none" id="IoTHub Gateway-IoTHub EH Client" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="561.81,234.2302,561.2874,224.3952,559.5397,229.7754,554.1596,228.0277,561.81,234.2302" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="508.61,129.5102,509.1075,139.3465,510.8689,133.9709,516.2446,135.7322,508.61,129.5102" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110" x="534" y="174.3308">AMQP (EH Module)</text><!--MD5=[cbcbca9f985bb6aa0d9e9d43e5dd7433]
link IoTHub Gateway to IoTHub HLM Client--><path d="M414.42,109.9502 C286.17,130.4202 46,179.0702 46,256.2702 C46,256.2702 46,256.2702 46,806.7702 C46,864.8902 75.76,927.6902 95.01,962.2202 " fill="none" id="IoTHub Gateway-IoTHub HLM Client" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="97.53,966.7002,96.5933,956.896,95.0739,962.345,89.6249,960.8257,97.53,966.7002" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="419.69,109.1102,410.1797,106.5501,414.7501,109.8834,411.4168,114.4539,419.69,109.1102" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110" x="47" y="535.3308">AMQP (HL Module)</text><!--MD5=[a20d16dcaadd67f259e89e744d6fba35]
reverse link IoTHub Gateway to EA Runtime--><path d="M571.15,98.7002 C674.2,101.5602 858.72,117.0502 998,186.2702 C1020.81,197.6102 1041.54,218.1202 1055.39,234.0202 " fill="none" id="IoTHub Gateway-backto-EA Runtime" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="566,98.5702,574.8942,102.8003,570.9983,98.6988,575.0998,94.8029,566,98.5702" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="974" y="174.3308">HTTPS</text><!--MD5=[dfc1fea4fe6ba54dff9a4399ad18d1a9]
@startuml
title Data Flow - new architecture

cloud "DPS Service" {
    [DPS Gateway] <<service>>
}

cloud "PKI" {
    [PKI Service] <<service>>
}

cloud "IoT Hub Service" {
    [IoTHub Gateway] <<service>>
}

node "Identity Service" <<new>> {
    [IS API Server] <<newclient>>
}

node "Key Service" <<new>> {
    [KS API Server] <<newclient>>
    [KS API Server] <<newclient>>
}

node "Certificate Service" <<new>> {
    [CS API Server] <<newclient>>
}

node "Edge Module Runtime" <<modified>> {
    folder "MR Legacy Service" {
        [MR API Server]
    }
    [MR Client] <<newclient>>
}
node "Edge Agent" {
    [EA Runtime]
    [MR EA Client]
}
node "Host-level module" {
    [HLM Client] <<newclient>>
    [IoTHub HLM Client]
}
node "Edge Hub" {
    [MR EH Client]
    [IoTHub EH Client]
}

database "HSM"

[MR Client] -down-> [IS API Server] : IPC
[MR Client] -down-> [CS API Server] : IPC
[MR Client] -down-> [KS API Server] : IPC
[HLM Client] -left-> [IS API Server] : IPC
[HLM Client] -left-> [KS API Server] : IPC
[MR EH Client] - -> [MR API Server] : IPC
[MR EA Client] - -> [MR API Server] : IPC

[MR API Server] - -> [MR Client]
[IS API Server] -down-> [KS API Server]
[IS API Server] -down-> [CS API Server]
[KS API Server] -down-> HSM : libaziot-keys

[IS API Server] -up-> [IoTHub Gateway] : HTTPS
[IS API Server] -up-> [DPS Gateway] : HTTPS
[IS API Server] -up-> [PKI Service] : HTTPS

[IoTHub EH Client] <-up-> [IoTHub Gateway] : AMQP (EH Module)
[IoTHub HLM Client] <-up-> [IoTHub Gateway] : AMQP (HL Module)

[EA Runtime] -up-> [IoTHub Gateway] : HTTPS

skinparam node {
	backgroundColor<<new>> Magenta
	backgroundColor<<modified>> Yellow
}

skinparam component {
    backgroundColor White
    backgroundColor<<newclient>> Cyan
    backgroundColor<<modified>> Yellow
    backgroundColor<<service>> White
}

@enduml

PlantUML version 1.2020.17(Sat Sep 19 05:30:11 PDT 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>