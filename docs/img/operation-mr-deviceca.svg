<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="3691px" preserveAspectRatio="none" style="width:1352px;height:3691px;" version="1.1" viewBox="0 0 1352 3691" width="1352px" zoomAndPan="magnify"><defs><filter height="300%" id="f1vnohgqi0p9s0" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="181" x="582.5" y="26.6992">MR Runtime Operation</text><rect fill="#FFFFFF" filter="url(#f1vnohgqi0p9s0)" height="706.2656" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="47.5" y="1289.6406"/><rect fill="#FFFFFF" filter="url(#f1vnohgqi0p9s0)" height="691.0313" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="47.5" y="2086.8438"/><rect fill="#FFFFFF" filter="url(#f1vnohgqi0p9s0)" height="307.8125" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="47.5" y="2838.3438"/><rect fill="#FFFFFF" filter="url(#f1vnohgqi0p9s0)" height="29.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="298.5" y="1057.5938"/><rect fill="#FFFFFF" filter="url(#f1vnohgqi0p9s0)" height="295.0469" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="298.5" y="1334.1094"/><rect fill="#FFFFFF" filter="url(#f1vnohgqi0p9s0)" height="295.0469" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="298.5" y="2131.3125"/><rect fill="#FFFFFF" filter="url(#f1vnohgqi0p9s0)" height="29.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="298.5" y="3268.3281"/><rect fill="#FFFFFF" filter="url(#f1vnohgqi0p9s0)" height="29.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="298.5" y="3477.4375"/><rect fill="#FFFFFF" filter="url(#f1vnohgqi0p9s0)" height="29.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="514.5" y="187.4375"/><rect fill="#FFFFFF" filter="url(#f1vnohgqi0p9s0)" height="29.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="514.5" y="409.3125"/><rect fill="#FFFFFF" filter="url(#f1vnohgqi0p9s0)" height="87.7031" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="514.5" y="580.9531"/><rect fill="#FFFFFF" filter="url(#f1vnohgqi0p9s0)" height="87.7031" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="514.5" y="843.9531"/><rect fill="#FFFFFF" filter="url(#f1vnohgqi0p9s0)" height="87.7031" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="514.5" y="2999.9844"/><rect fill="#FFFFFF" filter="url(#f1vnohgqi0p9s0)" height="29.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="682.5" y="128.9688"/><rect fill="#FFFFFF" filter="url(#f1vnohgqi0p9s0)" height="29.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="682.5" y="350.8438"/><rect fill="#FFFFFF" filter="url(#f1vnohgqi0p9s0)" height="29.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="682.5" y="610.1875"/><rect fill="#FFFFFF" filter="url(#f1vnohgqi0p9s0)" height="29.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="682.5" y="873.1875"/><rect fill="#FFFFFF" filter="url(#f1vnohgqi0p9s0)" height="29.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="682.5" y="1436.0469"/><rect fill="#FFFFFF" filter="url(#f1vnohgqi0p9s0)" height="74.9375" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="682.5" y="1524.9844"/><rect fill="#FFFFFF" filter="url(#f1vnohgqi0p9s0)" height="277.8125" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="682.5" y="1688.8594"/><rect fill="#FFFFFF" filter="url(#f1vnohgqi0p9s0)" height="29.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="682.5" y="2233.25"/><rect fill="#FFFFFF" filter="url(#f1vnohgqi0p9s0)" height="74.9375" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="682.5" y="2322.1875"/><rect fill="#FFFFFF" filter="url(#f1vnohgqi0p9s0)" height="262.5781" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="682.5" y="2486.0625"/><rect fill="#FFFFFF" filter="url(#f1vnohgqi0p9s0)" height="29.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="682.5" y="3029.2188"/><rect fill="#FFFFFF" filter="url(#f1vnohgqi0p9s0)" height="29.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="682.5" y="3357.2656"/><rect fill="#FFFFFF" filter="url(#f1vnohgqi0p9s0)" height="29.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="682.5" y="3581.6094"/><rect fill="#FFFFFF" filter="url(#f1vnohgqi0p9s0)" height="29.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="924.5" y="245.9063"/><rect fill="#FFFFFF" filter="url(#f1vnohgqi0p9s0)" height="29.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="924.5" y="483.0156"/><rect fill="#FFFFFF" filter="url(#f1vnohgqi0p9s0)" height="29.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="924.5" y="697.8906"/><rect fill="#FFFFFF" filter="url(#f1vnohgqi0p9s0)" height="29.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="924.5" y="960.8906"/><rect fill="#FFFFFF" filter="url(#f1vnohgqi0p9s0)" height="249.3438" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="924.5" y="2867.5781"/><rect fill="#FFFFFF" filter="url(#f1vnohgqi0p9s0)" height="192.6406" style="stroke: #000000; stroke-width: 2.0;" width="934.5" x="23" y="90.5"/><rect fill="#FFFFFF" filter="url(#f1vnohgqi0p9s0)" height="707.9844" style="stroke: #000000; stroke-width: 2.0;" width="954.5" x="13" y="297.1406"/><rect fill="#FFFFFF" filter="url(#f1vnohgqi0p9s0)" height="470.875" style="stroke: #000000; stroke-width: 2.0;" width="934.5" x="23" y="527.25"/><rect fill="#FFFFFF" height="263" style="stroke: none; stroke-width: 1.0;" width="934.5" x="23" y="735.125"/><rect fill="#FFFFFF" filter="url(#f1vnohgqi0p9s0)" height="163.3438" style="stroke: #000000; stroke-width: 2.0;" width="1186" x="23" y="1019.125"/><rect fill="#FFFFFF" filter="url(#f1vnohgqi0p9s0)" height="1964.6875" style="stroke: #000000; stroke-width: 2.0;" width="1206" x="13" y="1196.4688"/><rect fill="#FFFFFF" filter="url(#f1vnohgqi0p9s0)" height="783.2031" style="stroke: #000000; stroke-width: 2.0;" width="1186" x="23" y="1220.7031"/><rect fill="#FFFFFF" filter="url(#f1vnohgqi0p9s0)" height="767.9688" style="stroke: #000000; stroke-width: 2.0;" width="1186" x="23" y="2017.9063"/><rect fill="#FFFFFF" filter="url(#f1vnohgqi0p9s0)" height="354.2813" style="stroke: #000000; stroke-width: 2.0;" width="1186" x="23" y="2799.875"/><rect fill="#FFFFFF" filter="url(#f1vnohgqi0p9s0)" height="450.6875" style="stroke: #000000; stroke-width: 2.0;" width="1064.5" x="268.5" y="3175.1563"/><rect fill="#FFFFFF" filter="url(#f1vnohgqi0p9s0)" height="195.1094" style="stroke: #000000; stroke-width: 2.0;" width="1044.5" x="278.5" y="3199.3906"/><rect fill="#FFFFFF" filter="url(#f1vnohgqi0p9s0)" height="210.3438" style="stroke: #000000; stroke-width: 2.0;" width="1044.5" x="278.5" y="3408.5"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="52" x2="52" y1="73.5" y2="3642.8438"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="303.5" x2="303.5" y1="73.5" y2="3642.8438"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="519" x2="519" y1="73.5" y2="3642.8438"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="687" x2="687" y1="73.5" y2="3642.8438"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="929.5" x2="929.5" y1="73.5" y2="3642.8438"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1166" x2="1166" y1="1169.7656" y2="3642.8438"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1261" x2="1261" y1="73.5" y2="3642.8438"/><rect fill="#FEFECE" filter="url(#f1vnohgqi0p9s0)" height="30.4063" style="stroke: #A80036; stroke-width: 1.5;" width="35" x="33" y="38.0938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="21" x="40" y="58.082">MR</text><rect fill="#FEFECE" filter="url(#f1vnohgqi0p9s0)" height="30.4063" style="stroke: #A80036; stroke-width: 1.5;" width="35" x="33" y="3641.8438"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="21" x="40" y="3661.832">MR</text><rect fill="#FEFECE" filter="url(#f1vnohgqi0p9s0)" height="30.4063" style="stroke: #A80036; stroke-width: 1.5;" width="26" x="288.5" y="38.0938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="12" x="295.5" y="58.082">IS</text><rect fill="#FEFECE" filter="url(#f1vnohgqi0p9s0)" height="30.4063" style="stroke: #A80036; stroke-width: 1.5;" width="26" x="288.5" y="3641.8438"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="12" x="295.5" y="3661.832">IS</text><rect fill="#FEFECE" filter="url(#f1vnohgqi0p9s0)" height="30.4063" style="stroke: #A80036; stroke-width: 1.5;" width="133" x="451" y="38.0938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="119" x="458" y="58.082">openssl-engine-ks</text><rect fill="#FEFECE" filter="url(#f1vnohgqi0p9s0)" height="30.4063" style="stroke: #A80036; stroke-width: 1.5;" width="133" x="451" y="3641.8438"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="119" x="458" y="3661.832">openssl-engine-ks</text><rect fill="#FEFECE" filter="url(#f1vnohgqi0p9s0)" height="30.4063" style="stroke: #A80036; stroke-width: 1.5;" width="31" x="670" y="38.0938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="17" x="677" y="58.082">KS</text><rect fill="#FEFECE" filter="url(#f1vnohgqi0p9s0)" height="30.4063" style="stroke: #A80036; stroke-width: 1.5;" width="31" x="670" y="3641.8438"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="17" x="677" y="3661.832">KS</text><rect fill="#FEFECE" filter="url(#f1vnohgqi0p9s0)" height="30.4063" style="stroke: #A80036; stroke-width: 1.5;" width="32" x="911.5" y="38.0938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="18" x="918.5" y="58.082">CS</text><rect fill="#FEFECE" filter="url(#f1vnohgqi0p9s0)" height="30.4063" style="stroke: #A80036; stroke-width: 1.5;" width="32" x="911.5" y="3641.8438"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="18" x="918.5" y="3661.832">CS</text><rect fill="#FEFECE" filter="url(#f1vnohgqi0p9s0)" height="30.4063" style="stroke: #A80036; stroke-width: 1.5;" width="61" x="1134" y="3641.8438"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="47" x="1141" y="3661.832">Module</text><rect fill="#FEFECE" filter="url(#f1vnohgqi0p9s0)" height="30.4063" style="stroke: #A80036; stroke-width: 1.5;" width="100" x="1209" y="38.0938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="86" x="1216" y="58.082">Host_Module</text><rect fill="#FEFECE" filter="url(#f1vnohgqi0p9s0)" height="30.4063" style="stroke: #A80036; stroke-width: 1.5;" width="100" x="1209" y="3641.8438"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="86" x="1216" y="3661.832">Host_Module</text><rect fill="#FFFFFF" filter="url(#f1vnohgqi0p9s0)" height="706.2656" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="47.5" y="1289.6406"/><rect fill="#FFFFFF" filter="url(#f1vnohgqi0p9s0)" height="691.0313" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="47.5" y="2086.8438"/><rect fill="#FFFFFF" filter="url(#f1vnohgqi0p9s0)" height="307.8125" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="47.5" y="2838.3438"/><rect fill="#FFFFFF" filter="url(#f1vnohgqi0p9s0)" height="29.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="298.5" y="1057.5938"/><rect fill="#FFFFFF" filter="url(#f1vnohgqi0p9s0)" height="295.0469" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="298.5" y="1334.1094"/><rect fill="#FFFFFF" filter="url(#f1vnohgqi0p9s0)" height="295.0469" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="298.5" y="2131.3125"/><rect fill="#FFFFFF" filter="url(#f1vnohgqi0p9s0)" height="29.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="298.5" y="3268.3281"/><rect fill="#FFFFFF" filter="url(#f1vnohgqi0p9s0)" height="29.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="298.5" y="3477.4375"/><rect fill="#FFFFFF" filter="url(#f1vnohgqi0p9s0)" height="29.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="514.5" y="187.4375"/><rect fill="#FFFFFF" filter="url(#f1vnohgqi0p9s0)" height="29.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="514.5" y="409.3125"/><rect fill="#FFFFFF" filter="url(#f1vnohgqi0p9s0)" height="87.7031" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="514.5" y="580.9531"/><rect fill="#FFFFFF" filter="url(#f1vnohgqi0p9s0)" height="87.7031" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="514.5" y="843.9531"/><rect fill="#FFFFFF" filter="url(#f1vnohgqi0p9s0)" height="87.7031" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="514.5" y="2999.9844"/><rect fill="#FFFFFF" filter="url(#f1vnohgqi0p9s0)" height="29.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="682.5" y="128.9688"/><rect fill="#FFFFFF" filter="url(#f1vnohgqi0p9s0)" height="29.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="682.5" y="350.8438"/><rect fill="#FFFFFF" filter="url(#f1vnohgqi0p9s0)" height="29.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="682.5" y="610.1875"/><rect fill="#FFFFFF" filter="url(#f1vnohgqi0p9s0)" height="29.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="682.5" y="873.1875"/><rect fill="#FFFFFF" filter="url(#f1vnohgqi0p9s0)" height="29.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="682.5" y="1436.0469"/><rect fill="#FFFFFF" filter="url(#f1vnohgqi0p9s0)" height="74.9375" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="682.5" y="1524.9844"/><rect fill="#FFFFFF" filter="url(#f1vnohgqi0p9s0)" height="277.8125" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="682.5" y="1688.8594"/><rect fill="#FFFFFF" filter="url(#f1vnohgqi0p9s0)" height="29.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="682.5" y="2233.25"/><rect fill="#FFFFFF" filter="url(#f1vnohgqi0p9s0)" height="74.9375" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="682.5" y="2322.1875"/><rect fill="#FFFFFF" filter="url(#f1vnohgqi0p9s0)" height="262.5781" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="682.5" y="2486.0625"/><rect fill="#FFFFFF" filter="url(#f1vnohgqi0p9s0)" height="29.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="682.5" y="3029.2188"/><rect fill="#FFFFFF" filter="url(#f1vnohgqi0p9s0)" height="29.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="682.5" y="3357.2656"/><rect fill="#FFFFFF" filter="url(#f1vnohgqi0p9s0)" height="29.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="682.5" y="3581.6094"/><rect fill="#FFFFFF" filter="url(#f1vnohgqi0p9s0)" height="29.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="924.5" y="245.9063"/><rect fill="#FFFFFF" filter="url(#f1vnohgqi0p9s0)" height="29.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="924.5" y="483.0156"/><rect fill="#FFFFFF" filter="url(#f1vnohgqi0p9s0)" height="29.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="924.5" y="697.8906"/><rect fill="#FFFFFF" filter="url(#f1vnohgqi0p9s0)" height="29.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="924.5" y="960.8906"/><rect fill="#FFFFFF" filter="url(#f1vnohgqi0p9s0)" height="249.3438" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="924.5" y="2867.5781"/><path d="M23,90.5 L131,90.5 L131,97.5 L121,107.5 L23,107.5 L23,90.5 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="192.6406" style="stroke: #000000; stroke-width: 2.0;" width="934.5" x="23" y="90.5"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="63" x="38" y="103.5605">Device CA</text><polygon fill="#A80036" points="670.5,124.9688,680.5,128.9688,670.5,132.9688,674.5,128.9688" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="52.5" x2="676.5" y1="128.9688" y2="128.9688"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="59.5" y="123.7949">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="157" x="70.5" y="123.7949">load_key_pair("device_ca")</text><polygon fill="#A80036" points="63.5,154.2031,53.5,158.2031,63.5,162.2031,59.5,158.2031" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="57.5" x2="686.5" y1="158.2031" y2="158.2031"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="69.5" y="153.0293">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="80.5" y="153.0293">OK("key handle")</text><polygon fill="#A80036" points="502.5,183.4375,512.5,187.4375,502.5,191.4375,506.5,187.4375" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="52.5" x2="508.5" y1="187.4375" y2="187.4375"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="59.5" y="182.2637">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="178" x="70.5" y="182.2637">load_private_key("key handle")</text><polygon fill="#A80036" points="63.5,212.6719,53.5,216.6719,63.5,220.6719,59.5,216.6719" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="57.5" x2="518.5" y1="216.6719" y2="216.6719"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="69.5" y="211.498">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110" x="80.5" y="211.498">openssl::EVP_PKEY</text><polygon fill="#A80036" points="912.5,241.9063,922.5,245.9063,912.5,249.9063,916.5,245.9063" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="52.5" x2="918.5" y1="245.9063" y2="245.9063"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="59.5" y="240.7324">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="70.5" y="240.7324">create_or_load_cert("device_ca")</text><polygon fill="#A80036" points="63.5,271.1406,53.5,275.1406,63.5,279.1406,59.5,275.1406" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="57.5" x2="928.5" y1="275.1406" y2="275.1406"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="69.5" y="269.9668">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="76" x="80.5" y="269.9668">OK(cert PEM)</text><path d="M13,297.1406 L139,297.1406 L139,304.1406 L129,314.1406 L13,314.1406 L13,297.1406 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="707.9844" style="stroke: #000000; stroke-width: 2.0;" width="954.5" x="13" y="297.1406"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="81" x="28" y="310.2012">Workload CA</text><polygon fill="#A80036" points="670.5,346.8438,680.5,350.8438,670.5,354.8438,674.5,350.8438" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="52.5" x2="676.5" y1="350.8438" y2="350.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="59.5" y="338.0527">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="178" x="70.5" y="330.4355">create_key_pair_if_not_exists("</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="85" x="70.5" y="345.6699">workload_ca")</text><polygon fill="#A80036" points="63.5,376.0781,53.5,380.0781,63.5,384.0781,59.5,380.0781" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="57.5" x2="686.5" y1="380.0781" y2="380.0781"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="69.5" y="374.9043">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="80.5" y="374.9043">OK("key handle")</text><polygon fill="#A80036" points="502.5,405.3125,512.5,409.3125,502.5,413.3125,506.5,409.3125" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="52.5" x2="508.5" y1="409.3125" y2="409.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="59.5" y="404.1387">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="178" x="70.5" y="404.1387">load_private_key("key handle")</text><polygon fill="#A80036" points="63.5,434.5469,53.5,438.5469,63.5,442.5469,59.5,438.5469" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="57.5" x2="518.5" y1="438.5469" y2="438.5469"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="69.5" y="433.373">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110" x="87.5" y="433.373">openssl::EVP_PKEY</text><polygon fill="#A80036" points="912.5,479.0156,922.5,483.0156,912.5,487.0156,916.5,483.0156" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="52.5" x2="918.5" y1="483.0156" y2="483.0156"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="59.5" y="470.2246">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="198" x="77.5" y="462.6074">create_or_load_cert("workload_ca</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="10" x="77.5" y="477.8418">")</text><polygon fill="#A80036" points="63.5,508.25,53.5,512.25,63.5,516.25,59.5,512.25" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="57.5" x2="928.5" y1="512.25" y2="512.25"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="69.5" y="507.0762">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="194" x="87.5" y="507.0762">OK(cert PEM) or Err(NOT_FOUND)</text><path d="M23,527.25 L86,527.25 L86,534.25 L76,544.25 L23,544.25 L23,527.25 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="470.875" style="stroke: #000000; stroke-width: 2.0;" width="934.5" x="23" y="527.25"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="38" y="540.3105">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="92" x="101" y="539.4551">[if OK(cert PEM)]</text><polygon fill="#A80036" points="502.5,576.9531,512.5,580.9531,502.5,584.9531,506.5,580.9531" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="52.5" x2="508.5" y1="580.9531" y2="580.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="59.5" y="568.1621">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="198" x="77.5" y="560.5449">openssl::X509_verify(CSR, device_</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="176" x="77.5" y="575.7793">ca privkey openssl::EVP_PKEY)</text><polygon fill="#A80036" points="670.5,606.1875,680.5,610.1875,670.5,614.1875,674.5,610.1875" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="524.5" x2="676.5" y1="610.1875" y2="610.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="531.5" y="605.0137">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="121" x="549.5" y="605.0137">sign("key handle", ...)</text><polygon fill="#A80036" points="535.5,635.4219,525.5,639.4219,535.5,643.4219,531.5,639.4219" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="529.5" x2="686.5" y1="639.4219" y2="639.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="541.5" y="634.248">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80" x="559.5" y="634.248">OK(signature)</text><polygon fill="#A80036" points="63.5,664.6563,53.5,668.6563,63.5,672.6563,59.5,668.6563" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="57.5" x2="518.5" y1="668.6563" y2="668.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="69.5" y="663.4824">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="87.5" y="663.4824">OK(signed X509)</text><polygon fill="#A80036" points="912.5,693.8906,922.5,697.8906,912.5,701.8906,916.5,697.8906" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="52.5" x2="918.5" y1="697.8906" y2="697.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="59.5" y="692.7168">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="188" x="77.5" y="692.7168">import("workload_ca", cert PEM)</text><polygon fill="#A80036" points="63.5,723.125,53.5,727.125,63.5,731.125,59.5,727.125" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="57.5" x2="928.5" y1="727.125" y2="727.125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="69.5" y="721.9512">18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="17" x="87.5" y="721.9512">OK</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="23" x2="957.5" y1="736.125" y2="736.125"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="110" x="28" y="746.3301">[if Err(NOT_FOUND)]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="52.5" x2="94.5" y1="786.4844" y2="786.4844"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="94.5" x2="94.5" y1="786.4844" y2="799.4844"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="53.5" x2="94.5" y1="799.4844" y2="799.4844"/><polygon fill="#A80036" points="63.5,795.4844,53.5,799.4844,63.5,803.4844,59.5,799.4844" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="59.5" y="773.6934">19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190" x="77.5" y="766.0762">generate new CSR for workload_</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="14" x="77.5" y="781.3105">ca</text><polygon fill="#A80036" points="502.5,839.9531,512.5,843.9531,502.5,847.9531,506.5,843.9531" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="52.5" x2="508.5" y1="843.9531" y2="843.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="59.5" y="831.1621">20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="77.5" y="823.5449">openssl::X509_sign(CSR, device_</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="176" x="77.5" y="838.7793">ca privkey openssl::EVP_PKEY)</text><polygon fill="#A80036" points="670.5,869.1875,680.5,873.1875,670.5,877.1875,674.5,873.1875" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="524.5" x2="676.5" y1="873.1875" y2="873.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="531.5" y="868.0137">21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="121" x="549.5" y="868.0137">sign("key handle", ...)</text><polygon fill="#A80036" points="535.5,898.4219,525.5,902.4219,535.5,906.4219,531.5,902.4219" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="529.5" x2="686.5" y1="902.4219" y2="902.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="541.5" y="897.248">22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80" x="559.5" y="897.248">OK(signature)</text><polygon fill="#A80036" points="63.5,927.6563,53.5,931.6563,63.5,935.6563,59.5,931.6563" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="57.5" x2="518.5" y1="931.6563" y2="931.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="69.5" y="926.4824">23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="87.5" y="926.4824">OK(signed X509)</text><polygon fill="#A80036" points="912.5,956.8906,922.5,960.8906,912.5,964.8906,916.5,960.8906" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="52.5" x2="918.5" y1="960.8906" y2="960.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="59.5" y="955.7168">24</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="188" x="77.5" y="955.7168">import("workload_ca", cert PEM)</text><polygon fill="#A80036" points="63.5,986.125,53.5,990.125,63.5,994.125,59.5,990.125" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="57.5" x2="928.5" y1="990.125" y2="990.125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="69.5" y="984.9512">25</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="17" x="87.5" y="984.9512">OK</text><path d="M23,1019.125 L113,1019.125 L113,1026.125 L103,1036.125 L23,1036.125 L23,1019.125 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="163.3438" style="stroke: #000000; stroke-width: 2.0;" width="1186" x="23" y="1019.125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="45" x="38" y="1032.1855">MR init</text><polygon fill="#A80036" points="286.5,1053.5938,296.5,1057.5938,286.5,1061.5938,290.5,1057.5938" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="52.5" x2="292.5" y1="1057.5938" y2="1057.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="59.5" y="1052.4199">26</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135" x="77.5" y="1052.4199">get_provisioning_info()</text><polygon fill="#A80036" points="63.5,1082.8281,53.5,1086.8281,63.5,1090.8281,59.5,1086.8281" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="57.5" x2="302.5" y1="1086.8281" y2="1086.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="69.5" y="1081.6543">27</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="124" x="87.5" y="1081.6543">OK(provisioning info)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="52.5" x2="94.5" y1="1116.0625" y2="1116.0625"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="94.5" x2="94.5" y1="1116.0625" y2="1129.0625"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="53.5" x2="94.5" y1="1129.0625" y2="1129.0625"/><polygon fill="#A80036" points="63.5,1125.0625,53.5,1129.0625,63.5,1133.0625,59.5,1129.0625" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="59.5" y="1110.8887">28</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="82" x="77.5" y="1110.8887">Start modules</text><polygon fill="#A80036" points="1122,1154.2969,1132,1158.2969,1122,1162.2969,1126,1158.2969" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="52.5" x2="1128" y1="1158.2969" y2="1158.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="59.5" y="1153.123">29</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="80.5" y="1153.123"/><rect fill="#FEFECE" filter="url(#f1vnohgqi0p9s0)" height="30.4063" style="stroke: #A80036; stroke-width: 1.5;" width="61" x="1134" y="1137.0625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="47" x="1141" y="1157.0508">Module</text><path d="M13,1196.4688 L149,1196.4688 L149,1203.4688 L139,1213.4688 L13,1213.4688 L13,1196.4688 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1964.6875" style="stroke: #000000; stroke-width: 2.0;" width="1206" x="13" y="1196.4688"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="91" x="28" y="1209.5293">Module things</text><path d="M23,1220.7031 L282,1220.7031 L282,1227.7031 L272,1237.7031 L23,1237.7031 L23,1220.7031 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="783.2031" style="stroke: #000000; stroke-width: 2.0;" width="1186" x="23" y="1220.7031"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="214" x="38" y="1233.7637">Module wants to encrypt a secret</text><polygon fill="#A80036" points="68.5,1285.6406,58.5,1289.6406,68.5,1293.6406,64.5,1289.6406" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="62.5" x2="1165.5" y1="1289.6406" y2="1289.6406"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="74.5" y="1269.2324">30</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="92.5" y="1253.998">encrypt(plaintext) (e.g. encrypt(b"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="188" x="92.5" y="1269.2324">foo"), module_id = "edgeAgent",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="85" x="92.5" y="1284.4668">gen_id = 1000)</text><polygon fill="#A80036" points="286.5,1330.1094,296.5,1334.1094,286.5,1338.1094,290.5,1334.1094" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="57.5" x2="292.5" y1="1334.1094" y2="1334.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="64.5" y="1321.3184">31</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="82.5" y="1313.7012">get_encryption_key(module_id,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="44" x="82.5" y="1328.9355">gen_id)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="308.5" x2="350.5" y1="1378.5781" y2="1378.5781"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="350.5" x2="350.5" y1="1378.5781" y2="1391.5781"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="309.5" x2="350.5" y1="1391.5781" y2="1391.5781"/><polygon fill="#A80036" points="319.5,1387.5781,309.5,1391.5781,319.5,1395.5781,315.5,1391.5781" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="315.5" y="1365.7871">32</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="174" x="333.5" y="1358.1699">Derive module ID digest (e.g. "</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="105" x="333.5" y="1373.4043">edgeAgent:1000")</text><polygon fill="#A80036" points="670.5,1432.0469,680.5,1436.0469,670.5,1440.0469,674.5,1436.0469" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="308.5" x2="676.5" y1="1436.0469" y2="1436.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="315.5" y="1423.2559">33</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="196" x="333.5" y="1415.6387">create_key_if_not_exists("master_</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97" x="333.5" y="1430.873">encryption_key")</text><polygon fill="#A80036" points="319.5,1461.2813,309.5,1465.2813,319.5,1469.2813,315.5,1465.2813" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="313.5" x2="686.5" y1="1465.2813" y2="1465.2813"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="325.5" y="1460.1074">34</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="343.5" y="1460.1074">OK("key handle")</text><polygon fill="#A80036" points="670.5,1520.9844,680.5,1524.9844,670.5,1528.9844,674.5,1524.9844" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="308.5" x2="676.5" y1="1524.9844" y2="1524.9844"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="315.5" y="1504.5762">35</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="333.5" y="1489.3418">create_derived_key("master</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="196" x="333.5" y="1504.5762">encryption key handle", module ID</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="42" x="333.5" y="1519.8105">digest)</text><polygon fill="#A80036" points="319.5,1595.9219,309.5,1599.9219,319.5,1603.9219,315.5,1599.9219" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="313.5" x2="686.5" y1="1599.9219" y2="1599.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="325.5" y="1571.8965">36</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="199" x="343.5" y="1549.0449">OK(module encryption key handle)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="343.5" y="1564.2793">(e.g. token({ base: "master</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="185" x="343.5" y="1579.5137">encryption key handle", digest: "</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="343.5" y="1594.748">edgeAgent:1000" }))</text><polygon fill="#A80036" points="68.5,1625.1563,58.5,1629.1563,68.5,1633.1563,64.5,1629.1563" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="62.5" x2="302.5" y1="1629.1563" y2="1629.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="74.5" y="1623.9824">37</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="199" x="92.5" y="1623.9824">OK(module encryption key handle)</text><polygon fill="#A80036" points="670.5,1684.8594,680.5,1688.8594,670.5,1692.8594,674.5,1688.8594" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="57.5" x2="676.5" y1="1688.8594" y2="1688.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="64.5" y="1668.4512">38</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="178" x="82.5" y="1653.2168">encrypt(module encryption key</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="177" x="82.5" y="1668.4512">handle, plaintext) (e.g. encrypt(</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="106" x="82.5" y="1683.6855">token(...), b"foo"))</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="692.5" x2="734.5" y1="1748.5625" y2="1748.5625"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="734.5" x2="734.5" y1="1748.5625" y2="1761.5625"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="693.5" x2="734.5" y1="1761.5625" y2="1761.5625"/><polygon fill="#A80036" points="703.5,1757.5625,693.5,1761.5625,703.5,1765.5625,699.5,1761.5625" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="699.5" y="1728.1543">39</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="717.5" y="1712.9199">Get master encryption key handle</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="161" x="717.5" y="1728.1543">and module id digest out of</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="173" x="717.5" y="1743.3887">module encryption key handle</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="692.5" x2="734.5" y1="1851.7344" y2="1851.7344"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="734.5" x2="734.5" y1="1851.7344" y2="1864.7344"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="693.5" x2="734.5" y1="1864.7344" y2="1864.7344"/><polygon fill="#A80036" points="703.5,1860.7344,693.5,1864.7344,703.5,1868.7344,699.5,1864.7344" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="699.5" y="1816.0918">40</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="179" x="717.5" y="1785.623">module_encryption_key = sign(</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="172" x="717.5" y="1800.8574">master encryption key handle,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="163" x="717.5" y="1816.0918">module id digest) (i.e. sign("</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="149" x="717.5" y="1831.3262">master_encryption_key", "</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110" x="717.5" y="1846.5605">edgeAgent:1000"))</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="692.5" x2="734.5" y1="1924.4375" y2="1924.4375"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="734.5" x2="734.5" y1="1924.4375" y2="1937.4375"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="693.5" x2="734.5" y1="1937.4375" y2="1937.4375"/><polygon fill="#A80036" points="703.5,1933.4375,693.5,1937.4375,703.5,1941.4375,699.5,1937.4375" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="699.5" y="1904.0293">41</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="187" x="717.5" y="1888.7949">encrypt(module_encryption_key,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="177" x="717.5" y="1904.0293">plaintext) (i.e. encrypt(module_</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="142" x="717.5" y="1919.2637">encryption_key, b"foo"))</text><polygon fill="#A80036" points="68.5,1962.6719,58.5,1966.6719,68.5,1970.6719,64.5,1966.6719" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="62.5" x2="686.5" y1="1966.6719" y2="1966.6719"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="74.5" y="1961.498">42</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="83" x="92.5" y="1961.498">OK(ciphertext)</text><polygon fill="#A80036" points="1154.5,1991.9063,1164.5,1995.9063,1154.5,1999.9063,1158.5,1995.9063" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="52.5" x2="1160.5" y1="1995.9063" y2="1995.9063"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="59.5" y="1990.7324">43</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="83" x="77.5" y="1990.7324">OK(ciphertext)</text><path d="M23,2017.9063 L366,2017.9063 L366,2024.9063 L356,2034.9063 L23,2034.9063 L23,2017.9063 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="767.9688" style="stroke: #000000; stroke-width: 2.0;" width="1186" x="23" y="2017.9063"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="298" x="38" y="2030.9668">Module wants to sign (HMAC-SHA256) a digest</text><polygon fill="#A80036" points="68.5,2082.8438,58.5,2086.8438,68.5,2090.8438,64.5,2086.8438" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="62.5" x2="1165.5" y1="2086.8438" y2="2086.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="74.5" y="2066.4355">44</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="178" x="92.5" y="2051.2012">sign(digest) (e.g. sign(b"foo"),</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="193" x="92.5" y="2066.4355">module_id = "edgeAgent", gen_id</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="92.5" y="2081.6699">= 1000, key_id = "primary")</text><polygon fill="#A80036" points="286.5,2127.3125,296.5,2131.3125,286.5,2135.3125,290.5,2131.3125" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="57.5" x2="292.5" y1="2131.3125" y2="2131.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="64.5" y="2118.5215">45</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="82.5" y="2110.9043">get_identity_key(module_id, gen_</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="59" x="82.5" y="2126.1387">id, key_id)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="308.5" x2="350.5" y1="2175.7813" y2="2175.7813"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="350.5" x2="350.5" y1="2175.7813" y2="2188.7813"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="309.5" x2="350.5" y1="2188.7813" y2="2188.7813"/><polygon fill="#A80036" points="319.5,2184.7813,309.5,2188.7813,319.5,2192.7813,315.5,2188.7813" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="315.5" y="2162.9902">46</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="174" x="333.5" y="2155.373">Derive module ID digest (e.g. "</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="151" x="333.5" y="2170.6074">edgeAgent:1000:primary")</text><polygon fill="#A80036" points="670.5,2229.25,680.5,2233.25,670.5,2237.25,674.5,2233.25" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="308.5" x2="676.5" y1="2233.25" y2="2233.25"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="315.5" y="2220.459">47</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="196" x="333.5" y="2212.8418">create_key_if_not_exists("master_</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="333.5" y="2228.0762">identity_key")</text><polygon fill="#A80036" points="319.5,2258.4844,309.5,2262.4844,319.5,2266.4844,315.5,2262.4844" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="313.5" x2="686.5" y1="2262.4844" y2="2262.4844"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="325.5" y="2257.3105">48</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="343.5" y="2257.3105">OK("key handle")</text><polygon fill="#A80036" points="670.5,2318.1875,680.5,2322.1875,670.5,2326.1875,674.5,2322.1875" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="308.5" x2="676.5" y1="2322.1875" y2="2322.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="315.5" y="2301.7793">49</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="333.5" y="2286.5449">create_derived_key("master</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="177" x="333.5" y="2301.7793">identity key handle", module ID</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="42" x="333.5" y="2317.0137">digest)</text><polygon fill="#A80036" points="319.5,2393.125,309.5,2397.125,319.5,2401.125,315.5,2397.125" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="313.5" x2="686.5" y1="2397.125" y2="2397.125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="325.5" y="2369.0996">50</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="197" x="343.5" y="2346.248">OK(module identity key handle) (e.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="183" x="343.5" y="2361.4824">g. token({ base: "master identity</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="195" x="343.5" y="2376.7168">key handle", digest: "edgeAgent:1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="343.5" y="2391.9512">000:primary" }))</text><polygon fill="#A80036" points="68.5,2422.3594,58.5,2426.3594,68.5,2430.3594,64.5,2426.3594" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="62.5" x2="302.5" y1="2426.3594" y2="2426.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="74.5" y="2421.1855">51</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="92.5" y="2421.1855">OK(module identity key handle)</text><polygon fill="#A80036" points="670.5,2482.0625,680.5,2486.0625,670.5,2490.0625,674.5,2486.0625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="57.5" x2="676.5" y1="2486.0625" y2="2486.0625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="64.5" y="2465.6543">52</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="186" x="82.5" y="2450.4199">sign(module identity key handle,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="198" x="82.5" y="2465.6543">digest) (e.g. sign(token(...), b"foo"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="10" x="82.5" y="2480.8887">))</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="692.5" x2="734.5" y1="2545.7656" y2="2545.7656"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="734.5" x2="734.5" y1="2545.7656" y2="2558.7656"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="693.5" x2="734.5" y1="2558.7656" y2="2558.7656"/><polygon fill="#A80036" points="703.5,2554.7656,693.5,2558.7656,703.5,2562.7656,699.5,2558.7656" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="699.5" y="2525.3574">53</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="198" x="717.5" y="2510.123">Get master identity key handle and</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="183" x="717.5" y="2525.3574">module id digest out of module</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="717.5" y="2540.5918">identity key handle</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="692.5" x2="734.5" y1="2633.7031" y2="2633.7031"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="734.5" x2="734.5" y1="2633.7031" y2="2646.7031"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="693.5" x2="734.5" y1="2646.7031" y2="2646.7031"/><polygon fill="#A80036" points="703.5,2642.7031,693.5,2646.7031,703.5,2650.7031,699.5,2646.7031" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="699.5" y="2605.6777">54</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="200" x="717.5" y="2582.8262">module_identity_key = sign(master</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="171" x="717.5" y="2598.0605">identity key handle, module id</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="196" x="717.5" y="2613.2949">digest) (i.e. sign("master_identity_</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="717.5" y="2628.5293">key", "edgeAgent:1000:primary"))</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="692.5" x2="734.5" y1="2706.4063" y2="2706.4063"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="734.5" x2="734.5" y1="2706.4063" y2="2719.4063"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="693.5" x2="734.5" y1="2719.4063" y2="2719.4063"/><polygon fill="#A80036" points="703.5,2715.4063,693.5,2719.4063,703.5,2723.4063,699.5,2719.4063" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="699.5" y="2685.998">55</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="195" x="717.5" y="2670.7637">sign(module_identity_key, digest)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="189" x="717.5" y="2685.998">(i.e. sign(module_identity_key, b"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="717.5" y="2701.2324">foo"))</text><polygon fill="#A80036" points="68.5,2744.6406,58.5,2748.6406,68.5,2752.6406,64.5,2748.6406" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="62.5" x2="686.5" y1="2748.6406" y2="2748.6406"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="74.5" y="2743.4668">56</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80" x="92.5" y="2743.4668">OK(signature)</text><polygon fill="#A80036" points="1154.5,2773.875,1164.5,2777.875,1154.5,2781.875,1158.5,2777.875" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="52.5" x2="1160.5" y1="2777.875" y2="2777.875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="59.5" y="2772.7012">57</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80" x="77.5" y="2772.7012">OK(signature)</text><path d="M23,2799.875 L241,2799.875 L241,2806.875 L231,2816.875 L23,2816.875 L23,2799.875 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="354.2813" style="stroke: #000000; stroke-width: 2.0;" width="1186" x="23" y="2799.875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="173" x="38" y="2812.9355">Module wants a server cert</text><polygon fill="#A80036" points="68.5,2834.3438,58.5,2838.3438,68.5,2842.3438,64.5,2838.3438" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="62.5" x2="1165.5" y1="2838.3438" y2="2838.3438"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="74.5" y="2833.1699">58</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="92.5" y="2833.1699">Request server cert</text><polygon fill="#A80036" points="912.5,2863.5781,922.5,2867.5781,912.5,2871.5781,916.5,2867.5781" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="57.5" x2="918.5" y1="2867.5781" y2="2867.5781"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="64.5" y="2862.4043">59</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="82.5" y="2862.4043">Request server cert</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="934.5" x2="976.5" y1="2927.2813" y2="2927.2813"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="976.5" x2="976.5" y1="2927.2813" y2="2940.2813"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="935.5" x2="976.5" y1="2940.2813" y2="2940.2813"/><polygon fill="#A80036" points="945.5,2936.2813,935.5,2940.2813,945.5,2944.2813,941.5,2940.2813" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="941.5" y="2906.873">60</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="959.5" y="2891.6387">generate new privkey and CSR (in</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="188" x="959.5" y="2906.873">memory, not via openssl-engine-</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="19" x="959.5" y="2922.1074">ks)</text><polygon fill="#A80036" points="535.5,2995.9844,525.5,2999.9844,535.5,3003.9844,531.5,2999.9844" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="529.5" x2="923.5" y1="2999.9844" y2="2999.9844"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="541.5" y="2979.5762">61</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="145" x="559.5" y="2964.3418">openssl::X509_sign(CSR,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="197" x="559.5" y="2979.5762">workload_ca privkey openssl::EVP</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="40" x="559.5" y="2994.8105">_PKEY)</text><polygon fill="#A80036" points="670.5,3025.2188,680.5,3029.2188,670.5,3033.2188,674.5,3029.2188" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="524.5" x2="676.5" y1="3029.2188" y2="3029.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="531.5" y="3024.0449">62</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="121" x="549.5" y="3024.0449">sign("key handle", ...)</text><polygon fill="#A80036" points="535.5,3054.4531,525.5,3058.4531,535.5,3062.4531,531.5,3058.4531" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="529.5" x2="686.5" y1="3058.4531" y2="3058.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="541.5" y="3053.2793">63</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80" x="559.5" y="3053.2793">OK(signature)</text><polygon fill="#A80036" points="912.5,3083.6875,922.5,3087.6875,912.5,3091.6875,916.5,3087.6875" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="519.5" x2="918.5" y1="3087.6875" y2="3087.6875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="526.5" y="3082.5137">64</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="544.5" y="3082.5137">OK(signed X509)</text><polygon fill="#A80036" points="68.5,3112.9219,58.5,3116.9219,68.5,3120.9219,64.5,3116.9219" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="62.5" x2="928.5" y1="3116.9219" y2="3116.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="74.5" y="3111.748">65</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="133" x="92.5" y="3111.748">OK(privkey, server cert)</text><polygon fill="#A80036" points="1154.5,3142.1563,1164.5,3146.1563,1154.5,3150.1563,1158.5,3146.1563" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="52.5" x2="1160.5" y1="3146.1563" y2="3146.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="59.5" y="3140.9824">66</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="133" x="77.5" y="3140.9824">OK(privkey, server cert)</text><path d="M268.5,3175.1563 L457.5,3175.1563 L457.5,3182.1563 L447.5,3192.1563 L268.5,3192.1563 L268.5,3175.1563 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="450.6875" style="stroke: #000000; stroke-width: 2.0;" width="1064.5" x="268.5" y="3175.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="144" x="283.5" y="3188.2168">Host_Module API calls</text><path d="M278.5,3199.3906 L571.5,3199.3906 L571.5,3206.3906 L561.5,3216.3906 L278.5,3216.3906 L278.5,3199.3906 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="195.1094" style="stroke: #000000; stroke-width: 2.0;" width="1044.5" x="278.5" y="3199.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="248" x="293.5" y="3212.4512">Host module wants to encrypt a secret</text><polygon fill="#A80036" points="319.5,3264.3281,309.5,3268.3281,319.5,3272.3281,315.5,3268.3281" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="313.5" x2="1260" y1="3268.3281" y2="3268.3281"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="325.5" y="3247.9199">67</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="198" x="343.5" y="3232.6855">Similar process to MR above: get_</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="197" x="343.5" y="3247.9199">encryption_key(module_id, gen_id</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="343.5" y="3263.1543">)</text><polygon fill="#A80036" points="1249,3293.5625,1259,3297.5625,1249,3301.5625,1253,3297.5625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="303.5" x2="1255" y1="3297.5625" y2="3297.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="310.5" y="3292.3887">68</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="328.5" y="3292.3887">OK("key handle")</text><polygon fill="#A80036" points="703.5,3353.2656,693.5,3357.2656,703.5,3361.2656,699.5,3357.2656" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="697.5" x2="1260" y1="3357.2656" y2="3357.2656"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="709.5" y="3336.8574">69</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="170" x="727.5" y="3321.623">Similar process to MR above:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="178" x="727.5" y="3336.8574">encrypt(module encryption key</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="727.5" y="3352.0918">handle, plaintext)</text><polygon fill="#A80036" points="1249,3382.5,1259,3386.5,1249,3390.5,1253,3386.5" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="687.5" x2="1255" y1="3386.5" y2="3386.5"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="694.5" y="3381.3262">70</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="83" x="712.5" y="3381.3262">OK(ciphertext)</text><path d="M278.5,3408.5 L655.5,3408.5 L655.5,3415.5 L645.5,3425.5 L278.5,3425.5 L278.5,3408.5 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="210.3438" style="stroke: #000000; stroke-width: 2.0;" width="1044.5" x="278.5" y="3408.5"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="332" x="293.5" y="3421.5605">Host module wants to sign (HMAC-SHA256) a digest</text><polygon fill="#A80036" points="319.5,3473.4375,309.5,3477.4375,319.5,3481.4375,315.5,3477.4375" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="313.5" x2="1260" y1="3477.4375" y2="3477.4375"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="325.5" y="3457.0293">71</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="198" x="343.5" y="3441.7949">Similar process to MR above: get_</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="343.5" y="3457.0293">identity_key(module_id, gen_id,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="42" x="343.5" y="3472.2637">key_id)</text><polygon fill="#A80036" points="1249,3502.6719,1259,3506.6719,1249,3510.6719,1253,3506.6719" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="303.5" x2="1255" y1="3506.6719" y2="3506.6719"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="310.5" y="3501.498">72</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="328.5" y="3501.498">OK("key handle")</text><polygon fill="#A80036" points="703.5,3577.6094,693.5,3581.6094,703.5,3585.6094,699.5,3581.6094" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="697.5" x2="1260" y1="3581.6094" y2="3581.6094"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="709.5" y="3553.584">73</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="198" x="727.5" y="3530.7324">Similar process to MR above: sign</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="161" x="727.5" y="3545.9668">(module identity key handle,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="198" x="727.5" y="3561.2012">digest) (e.g. sign(token(...), b"foo"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="10" x="727.5" y="3576.4355">))</text><polygon fill="#A80036" points="1249,3606.8438,1259,3610.8438,1249,3614.8438,1253,3610.8438" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="687.5" x2="1255" y1="3610.8438" y2="3610.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="694.5" y="3605.6699">74</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80" x="712.5" y="3605.6699">OK(signature)</text><!--MD5=[542b12648e493d1ea44fa2b3f6e6b156]
@startuml

title MR Runtime Operation
skinparam maxMessageSize 200

participant MR
participant IS
participant "openssl-engine-ks"
participant KS
participant CS
participant Module
participant Host_Module

autonumber


group Device CA
	MR -> KS ++: load_key_pair("device_ca")
	return OK("key handle")
	MR -> "openssl-engine-ks" ++: load_private_key("key handle")
	return openssl::EVP_PKEY
	MR -> CS ++: create_or_load_cert("device_ca")
	return OK(cert PEM)
end

group Workload CA
	MR -> KS ++: create_key_pair_if_not_exists("workload_ca")
	return OK("key handle")
	MR -> "openssl-engine-ks" ++: load_private_key("key handle")
	return openssl::EVP_PKEY
	MR -> CS ++: create_or_load_cert("workload_ca")
	return OK(cert PEM) or Err(NOT_FOUND)

	alt if OK(cert PEM)
		MR -> "openssl-engine-ks" ++: openssl::X509_verify(CSR, device_ca privkey openssl::EVP_PKEY)
		"openssl-engine-ks" -> KS ++: sign("key handle", ...)
		return OK(signature)
		return OK(signed X509)
		MR -> CS ++: import("workload_ca", cert PEM)
		return OK

	else if Err(NOT_FOUND)
		MR -> MR: generate new CSR for workload_ca
		MR -> "openssl-engine-ks" ++: openssl::X509_sign(CSR, device_ca privkey openssl::EVP_PKEY)
		"openssl-engine-ks" -> KS ++: sign("key handle", ...)
		return OK(signature)
		return OK(signed X509)
		MR -> CS ++: import("workload_ca", cert PEM)
		return OK
	end
end

group MR init
	MR -> IS ++: get_provisioning_info()
	return OK(provisioning info)

	MR -> MR: Start modules
	MR -> Module **
end

group Module things
	group Module wants to encrypt a secret
		Module -> MR ++: encrypt(plaintext) (e.g. encrypt(b"foo"), module_id = "edgeAgent", gen_id = 1000)
		MR -> IS ++: get_encryption_key(module_id, gen_id)
		IS -> IS: Derive module ID digest (e.g. "edgeAgent:1000")
		IS -> KS ++: create_key_if_not_exists("master_encryption_key")
		return OK("key handle")
		IS -> KS ++: create_derived_key("master encryption key handle", module ID digest)
		return OK(module encryption key handle) (e.g. token({ base: "master encryption key handle", digest: "edgeAgent:1000" }))
		return OK(module encryption key handle)
		MR -> KS ++: encrypt(module encryption key handle, plaintext) (e.g. encrypt(token(...), b"foo"))
		KS -> KS: Get master encryption key handle and module id digest out of module encryption key handle
		KS -> KS: module_encryption_key = sign(master encryption key handle, module id digest) (i.e. sign("master_encryption_key", "edgeAgent:1000"))
		KS -> KS: encrypt(module_encryption_key, plaintext) (i.e. encrypt(module_encryption_key, b"foo"))
		return OK(ciphertext)
		return OK(ciphertext)
	end

	group Module wants to sign (HMAC-SHA256) a digest
		Module -> MR ++: sign(digest) (e.g. sign(b"foo"), module_id = "edgeAgent", gen_id = 1000, key_id = "primary")
		MR -> IS ++: get_identity_key(module_id, gen_id, key_id)
		IS -> IS: Derive module ID digest (e.g. "edgeAgent:1000:primary")
		IS -> KS ++: create_key_if_not_exists("master_identity_key")
		return OK("key handle")
		IS -> KS ++: create_derived_key("master identity key handle", module ID digest)
		return OK(module identity key handle) (e.g. token({ base: "master identity key handle", digest: "edgeAgent:1000:primary" }))
		return OK(module identity key handle)
		MR -> KS ++: sign(module identity key handle, digest) (e.g. sign(token(...), b"foo"))
		KS -> KS: Get master identity key handle and module id digest out of module identity key handle
		KS -> KS: module_identity_key = sign(master identity key handle, module id digest) (i.e. sign("master_identity_key", "edgeAgent:1000:primary"))
		KS -> KS: sign(module_identity_key, digest) (i.e. sign(module_identity_key, b"foo"))
		return OK(signature)
		return OK(signature)
	end

	group Module wants a server cert
		Module -> MR ++: Request server cert
		MR -> CS ++: Request server cert
		CS -> CS: generate new privkey and CSR (in memory, not via openssl-engine-ks)
		CS -> "openssl-engine-ks" ++: openssl::X509_sign(CSR, workload_ca privkey openssl::EVP_PKEY)
		"openssl-engine-ks" -> KS ++: sign("key handle", ...)
		return OK(signature)
		return OK(signed X509)	
		return OK(privkey, server cert)
		return OK(privkey, server cert)
	end
end

group Host_Module API calls
	group Host module wants to encrypt a secret
		Host_Module -> IS ++: Similar process to MR above: get_encryption_key(module_id, gen_id)
		return OK("key handle")
		Host_Module -> KS ++: Similar process to MR above: encrypt(module encryption key handle, plaintext)
		return OK(ciphertext)
	end
	group Host module wants to sign (HMAC-SHA256) a digest
		Host_Module -> IS ++: Similar process to MR above: get_identity_key(module_id, gen_id, key_id)
		return OK("key handle")
		Host_Module -> KS ++: Similar process to MR above: sign(module identity key handle, digest) (e.g. sign(token(...), b"foo"))
		return OK(signature)
	end
end


@enduml

PlantUML version 1.2020.17(Sat Sep 19 05:30:11 PDT 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>