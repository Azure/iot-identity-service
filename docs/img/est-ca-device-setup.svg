<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="634px" preserveAspectRatio="none" style="width:1158px;height:634px;" version="1.1" viewBox="0 0 1158 634" width="1158px" zoomAndPan="magnify"><defs><filter height="300%" id="fpwrczed7qei5" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="111" x="520" y="27.4023">Device Setup</text><rect fill="#ADD8E6" height="584.5664" style="stroke: #A80036; stroke-width: 1.0;" width="609" x="538" y="39.1992"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="45" x="818" y="51.7676">Device</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="197" x2="197" y1="93.998" y2="585.2773"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="573" x2="573" y1="93.998" y2="585.2773"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="679" x2="679" y1="93.998" y2="585.2773"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="814" x2="814" y1="93.998" y2="585.2773"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="935" x2="935" y1="93.998" y2="585.2773"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1069" x2="1069" y1="93.998" y2="585.2773"/><rect fill="#FEFECE" filter="url(#fpwrczed7qei5)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="76" x="157" y="58.5098"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="62" x="164" y="79.0449">Operator</text><rect fill="#FEFECE" filter="url(#fpwrczed7qei5)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="76" x="157" y="584.2773"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="62" x="164" y="604.8125">Operator</text><rect fill="#FEFECE" filter="url(#fpwrczed7qei5)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="58" x="542" y="58.5098"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="44" x="549" y="79.0449">Device</text><rect fill="#FEFECE" filter="url(#fpwrczed7qei5)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="58" x="542" y="584.2773"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="44" x="549" y="604.8125">Device</text><rect fill="#FEFECE" filter="url(#fpwrczed7qei5)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="126" x="614" y="58.5098"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="112" x="621" y="79.0449">Module Runtime</text><rect fill="#FEFECE" filter="url(#fpwrczed7qei5)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="126" x="614" y="584.2773"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="112" x="621" y="604.8125">Module Runtime</text><rect fill="#FEFECE" filter="url(#fpwrczed7qei5)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="117" x="754" y="58.5098"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="103" x="761" y="79.0449">Identity Service</text><rect fill="#FEFECE" filter="url(#fpwrczed7qei5)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="117" x="754" y="584.2773"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="103" x="761" y="604.8125">Identity Service</text><rect fill="#FEFECE" filter="url(#fpwrczed7qei5)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="97" x="885" y="58.5098"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="83" x="892" y="79.0449">Keys Service</text><rect fill="#FEFECE" filter="url(#fpwrczed7qei5)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="97" x="885" y="584.2773"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="83" x="892" y="604.8125">Keys Service</text><rect fill="#FEFECE" filter="url(#fpwrczed7qei5)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="143" x="996" y="58.5098"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="129" x="1003" y="79.0449">Certificates Service</text><rect fill="#FEFECE" filter="url(#fpwrczed7qei5)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="143" x="996" y="584.2773"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="129" x="1003" y="604.8125">Certificates Service</text><polygon fill="#A80036" points="561,121.3086,571,125.3086,561,129.3086,565,125.3086" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="197" x2="567" y1="125.3086" y2="125.3086"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="204" y="120.5664">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="279" x="217" y="120.5664">Install OS and HSM-specific PKCS#11 library</text><polygon fill="#A80036" points="561,165.9297,571,169.9297,561,173.9297,565,169.9297" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="197" x2="567" y1="169.9297" y2="169.9297"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="204" y="157.5322">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="205" x="217" y="149.877">Generate new private key in HSM</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="339" x="217" y="165.1875">(via pkcs11-tool, p11tool, provider-specific tool, etc)</text><polygon fill="#A80036" points="561,210.5508,571,214.5508,561,218.5508,565,214.5508" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="197" x2="567" y1="214.5508" y2="214.5508"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="204" y="202.1533">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="313" x="217" y="194.498">Create CSR for bootstrap ID cert using private key</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="106" x="217" y="209.8086">(via openssl, etc)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="197" x2="239" y1="243.8613" y2="243.8613"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="239" x2="239" y1="243.8613" y2="256.8613"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="198" x2="239" y1="256.8613" y2="256.8613"/><polygon fill="#A80036" points="208,252.8613,198,256.8613,208,260.8613,204,256.8613" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="204" y="239.1191">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="212" x="217" y="239.1191">Sign CSR using device identity CA</text><polygon fill="#A80036" points="561,282.1719,571,286.1719,561,290.1719,565,286.1719" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="197" x2="567" y1="286.1719" y2="286.1719"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="204" y="281.4297">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="252" x="217" y="281.4297">Save bootstrap ID cert on the filesystem</text><polygon fill="#A80036" points="923.5,324.1377,933.5,328.1377,923.5,332.1377,927.5,328.1377" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="197" x2="929.5" y1="328.1377" y2="328.1377"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="204" y="323.3955">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="411" x="217" y="323.3955">Configure Keys Service to preload the bootstrap cert's private key</text><path d="M8,299.1719 L8,339.1719 L188,339.1719 L188,309.1719 L178,299.1719 L8,299.1719 " fill="#FBFB77" filter="url(#fpwrczed7qei5)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M178,299.1719 L178,309.1719 L188,309.1719 L178,299.1719 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="14" y="316.7402">See [1] below diagram for</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="142" x="14" y="332.0508">configuration example</text><polygon fill="#A80036" points="1057.5,378.7588,1067.5,382.7588,1057.5,386.7588,1061.5,382.7588" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="197" x2="1063.5" y1="382.7588" y2="382.7588"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="204" y="378.0166">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="371" x="217" y="378.0166">Configure Certificates Service to preload the bootstrap cert</text><path d="M8,353.793 L8,393.793 L188,393.793 L188,363.793 L178,353.793 L8,353.793 " fill="#FBFB77" filter="url(#fpwrczed7qei5)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M178,353.793 L178,363.793 L188,363.793 L178,353.793 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="14" y="371.3613">See [2] below diagram for</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="142" x="14" y="386.6719">configuration example</text><polygon fill="#A80036" points="802.5,433.3799,812.5,437.3799,802.5,441.3799,806.5,437.3799" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="197" x2="808.5" y1="437.3799" y2="437.3799"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="204" y="432.6377">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="409" x="217" y="432.6377">Configure Identity Service with device provisioning configuration</text><path d="M8,408.4141 L8,448.4141 L188,448.4141 L188,418.4141 L178,408.4141 L8,408.4141 " fill="#FBFB77" filter="url(#fpwrczed7qei5)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M178,408.4141 L178,418.4141 L188,418.4141 L178,408.4141 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="14" y="425.9824">See [3] below diagram for</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="142" x="14" y="441.293">configuration example</text><polygon fill="#A80036" points="667,475.3457,677,479.3457,667,483.3457,671,479.3457" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="197" x2="673" y1="479.3457" y2="479.3457"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="204" y="474.6035">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135" x="217" y="474.6035">Start Module Runtime</text><polygon fill="#A80036" points="802.5,504.6563,812.5,508.6563,802.5,512.6563,806.5,508.6563" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="197" x2="808.5" y1="508.6563" y2="508.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="204" y="503.9141">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129" x="226" y="503.9141">Start Identity Service</text><polygon fill="#A80036" points="923.5,533.9668,933.5,537.9668,923.5,541.9668,927.5,537.9668" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="197" x2="929.5" y1="537.9668" y2="537.9668"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="204" y="533.2246">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110" x="226" y="533.2246">Start Keys Service</text><polygon fill="#A80036" points="1057.5,563.2773,1067.5,567.2773,1057.5,571.2773,1061.5,567.2773" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="197" x2="1063.5" y1="567.2773" y2="567.2773"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="204" y="562.5352">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="153" x="226" y="562.5352">Start Certificates Service</text><!--MD5=[5c01570437afdd4598e7ad4223dd39a3]
@startuml

title Device Setup

participant "Operator" as operator

box Device #LightBlue
	participant "Device" as device
	participant "Module Runtime" as mr
	participant "Identity Service" as is
	participant "Keys Service" as ks
	participant "Certificates Service" as cs
end box

autonumber

operator -> device: Install OS and HSM-specific PKCS#11 library

operator -> device: Generate new private key in HSM\n(via pkcs11-tool, p11tool, provider-specific tool, etc)
operator -> device: Create CSR for bootstrap ID cert using private key\n(via openssl, etc)
operator -> operator: Sign CSR using device identity CA
operator -> device: Save bootstrap ID cert on the filesystem

operator -> ks: Configure Keys Service to preload the bootstrap cert's private key
note left
See [1] below diagram for
configuration example
end note

operator -> cs: Configure Certificates Service to preload the bootstrap cert
note left
See [2] below diagram for
configuration example
end note

operator -> is: Configure Identity Service with device provisioning configuration
note left
See [3] below diagram for
configuration example
end note

operator -> mr: Start Module Runtime
operator -> is: Start Identity Service
operator -> ks: Start Keys Service
operator -> cs: Start Certificates Service

@enduml

PlantUML version 1.2020.10(Sun May 17 02:35:57 PDT 2020)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 13.0.1+9
Operating System: Mac OS X
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>