<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="633px" preserveAspectRatio="none" style="width:1099px;height:633px;" version="1.1" viewBox="0 0 1099 633" width="1099px" zoomAndPan="magnify"><defs><filter height="300%" id="fpwrczed7qei5" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="106" x="493.25" y="26.6992">Device Setup</text><rect fill="#ADD8E6" height="583.0313" style="stroke: #A80036; stroke-width: 1.0;" width="597" x="491.5" y="39.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="42" x="767.5" y="51.1543">Device</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="187" x2="187" y1="93.7344" y2="583.7188"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="525.5" x2="525.5" y1="93.7344" y2="583.7188"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="627.5" x2="627.5" y1="93.7344" y2="583.7188"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="758.5" x2="758.5" y1="93.7344" y2="583.7188"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="877.5" x2="877.5" y1="93.7344" y2="583.7188"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1010.5" x2="1010.5" y1="93.7344" y2="583.7188"/><rect fill="#FEFECE" filter="url(#fpwrczed7qei5)" height="30.4063" style="stroke: #A80036; stroke-width: 1.5;" width="72" x="149" y="58.3281"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="58" x="156" y="78.3164">Operator</text><rect fill="#FEFECE" filter="url(#fpwrczed7qei5)" height="30.4063" style="stroke: #A80036; stroke-width: 1.5;" width="72" x="149" y="582.7188"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="58" x="156" y="602.707">Operator</text><rect fill="#FEFECE" filter="url(#fpwrczed7qei5)" height="30.4063" style="stroke: #A80036; stroke-width: 1.5;" width="57" x="495.5" y="58.3281"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="502.5" y="78.3164">Device</text><rect fill="#FEFECE" filter="url(#fpwrczed7qei5)" height="30.4063" style="stroke: #A80036; stroke-width: 1.5;" width="57" x="495.5" y="582.7188"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="502.5" y="602.707">Device</text><rect fill="#FEFECE" filter="url(#fpwrczed7qei5)" height="30.4063" style="stroke: #A80036; stroke-width: 1.5;" width="119" x="566.5" y="58.3281"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="105" x="573.5" y="78.3164">Module Runtime</text><rect fill="#FEFECE" filter="url(#fpwrczed7qei5)" height="30.4063" style="stroke: #A80036; stroke-width: 1.5;" width="119" x="566.5" y="582.7188"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="105" x="573.5" y="602.707">Module Runtime</text><rect fill="#FEFECE" filter="url(#fpwrczed7qei5)" height="30.4063" style="stroke: #A80036; stroke-width: 1.5;" width="114" x="699.5" y="58.3281"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="100" x="706.5" y="78.3164">Identity Service</text><rect fill="#FEFECE" filter="url(#fpwrczed7qei5)" height="30.4063" style="stroke: #A80036; stroke-width: 1.5;" width="114" x="699.5" y="582.7188"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="100" x="706.5" y="602.707">Identity Service</text><rect fill="#FEFECE" filter="url(#fpwrczed7qei5)" height="30.4063" style="stroke: #A80036; stroke-width: 1.5;" width="96" x="827.5" y="58.3281"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="82" x="834.5" y="78.3164">Keys Service</text><rect fill="#FEFECE" filter="url(#fpwrczed7qei5)" height="30.4063" style="stroke: #A80036; stroke-width: 1.5;" width="96" x="827.5" y="582.7188"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="82" x="834.5" y="602.707">Keys Service</text><rect fill="#FEFECE" filter="url(#fpwrczed7qei5)" height="30.4063" style="stroke: #A80036; stroke-width: 1.5;" width="143" x="937.5" y="58.3281"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="129" x="944.5" y="78.3164">Certificates Service</text><rect fill="#FEFECE" filter="url(#fpwrczed7qei5)" height="30.4063" style="stroke: #A80036; stroke-width: 1.5;" width="143" x="937.5" y="582.7188"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="129" x="944.5" y="602.707">Certificates Service</text><polygon fill="#A80036" points="514,120.9688,524,124.9688,514,128.9688,518,124.9688" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="187" x2="520" y1="124.9688" y2="124.9688"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="194" y="119.7949">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="258" x="205" y="119.7949">Install OS and HSM-specific PKCS#11 library</text><polygon fill="#A80036" points="514,165.4375,524,169.4375,514,173.4375,518,169.4375" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="187" x2="520" y1="169.4375" y2="169.4375"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="194" y="156.6465">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="189" x="205" y="149.0293">Generate new private key in HSM</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="304" x="205" y="164.2637">(via pkcs11-tool, p11tool, provider-specific tool, etc)</text><polygon fill="#A80036" points="514,209.9063,524,213.9063,514,217.9063,518,213.9063" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="187" x2="520" y1="213.9063" y2="213.9063"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="194" y="201.1152">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="286" x="205" y="193.498">Create CSR for bootstrap ID cert using private key</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="205" y="208.7324">(via openssl, etc)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="187" x2="229" y1="243.1406" y2="243.1406"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="229" x2="229" y1="243.1406" y2="256.1406"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="188" x2="229" y1="256.1406" y2="256.1406"/><polygon fill="#A80036" points="198,252.1406,188,256.1406,198,260.1406,194,256.1406" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="194" y="237.9668">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="195" x="205" y="237.9668">Sign CSR using device identity CA</text><polygon fill="#A80036" points="514,281.375,524,285.375,514,289.375,518,285.375" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="187" x2="520" y1="285.375" y2="285.375"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="194" y="280.2012">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="232" x="205" y="280.2012">Save bootstrap ID cert on the filesystem</text><polygon fill="#A80036" points="865.5,323.2266,875.5,327.2266,865.5,331.2266,869.5,327.2266" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="187" x2="871.5" y1="327.2266" y2="327.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="194" y="322.0527">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="379" x="205" y="322.0527">Configure Keys Service to preload the bootstrap cert's private key</text><path d="M8,298.375 L8,338.375 L178,338.375 L178,308.375 L168,298.375 L8,298.375 " fill="#FBFB77" filter="url(#fpwrczed7qei5)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M168,298.375 L168,308.375 L178,308.375 L168,298.375 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="149" x="14" y="315.4355">See [1] below diagram for</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="130" x="14" y="330.6699">configuration example</text><polygon fill="#A80036" points="999,377.6953,1009,381.6953,999,385.6953,1003,381.6953" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="187" x2="1005" y1="381.6953" y2="381.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="194" y="376.5215">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="342" x="205" y="376.5215">Configure Certificates Service to preload the bootstrap cert</text><path d="M8,352.8438 L8,392.8438 L178,392.8438 L178,362.8438 L168,352.8438 L8,352.8438 " fill="#FBFB77" filter="url(#fpwrczed7qei5)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M168,352.8438 L168,362.8438 L178,362.8438 L168,352.8438 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="149" x="14" y="369.9043">See [2] below diagram for</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="130" x="14" y="385.1387">configuration example</text><polygon fill="#A80036" points="746.5,432.1641,756.5,436.1641,746.5,440.1641,750.5,436.1641" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="187" x2="752.5" y1="436.1641" y2="436.1641"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="194" y="430.9902">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="372" x="205" y="430.9902">Configure Identity Service with device provisioning configuration</text><path d="M8,407.3125 L8,447.3125 L178,447.3125 L178,417.3125 L168,407.3125 L8,407.3125 " fill="#FBFB77" filter="url(#fpwrczed7qei5)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M168,407.3125 L168,417.3125 L178,417.3125 L168,407.3125 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="149" x="14" y="424.373">See [3] below diagram for</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="130" x="14" y="439.6074">configuration example</text><polygon fill="#A80036" points="616,474.0156,626,478.0156,616,482.0156,620,478.0156" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="187" x2="622" y1="478.0156" y2="478.0156"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="194" y="472.8418">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="125" x="205" y="472.8418">Start Module Runtime</text><polygon fill="#A80036" points="746.5,503.25,756.5,507.25,746.5,511.25,750.5,507.25" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="187" x2="752.5" y1="507.25" y2="507.25"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="194" y="502.0762">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="119" x="212" y="502.0762">Start Identity Service</text><polygon fill="#A80036" points="865.5,532.4844,875.5,536.4844,865.5,540.4844,869.5,536.4844" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="187" x2="871.5" y1="536.4844" y2="536.4844"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="194" y="531.3105">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="105" x="212" y="531.3105">Start Keys Service</text><polygon fill="#A80036" points="999,561.7188,1009,565.7188,999,569.7188,1003,565.7188" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="187" x2="1005" y1="565.7188" y2="565.7188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="194" y="560.5449">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="212" y="560.5449">Start Certificates Service</text><!--MD5=[bbac8a0ab9e77ab2a779e0cb35211faf]
@startuml

title Device Setup

participant "Operator" as operator

box Device #LightBlue
	participant "Device" as device
	participant "Module Runtime" as mr
	participant "Identity Service" as is
	participant "Keys Service" as ks
	participant "Certificates Service" as cs
end box

autonumber

operator -> device: Install OS and HSM-specific PKCS#11 library

operator -> device: Generate new private key in HSM\n(via pkcs11-tool, p11tool, provider-specific tool, etc)
operator -> device: Create CSR for bootstrap ID cert using private key\n(via openssl, etc)
operator -> operator: Sign CSR using device identity CA
operator -> device: Save bootstrap ID cert on the filesystem

operator -> ks: Configure Keys Service to preload the bootstrap cert's private key
note left
See [1] below diagram for
configuration example
end note

operator -> cs: Configure Certificates Service to preload the bootstrap cert
note left
See [2] below diagram for
configuration example
end note

operator -> is: Configure Identity Service with device provisioning configuration
note left
See [3] below diagram for
configuration example
end note

operator -> mr: Start Module Runtime
operator -> is: Start Identity Service
operator -> ks: Start Keys Service
operator -> cs: Start Certificates Service

@enduml

PlantUML version 1.2020.17(Sat Sep 19 05:30:11 PDT 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>