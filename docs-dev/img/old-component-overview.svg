<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="634px" preserveAspectRatio="none" style="width:808px;height:634px;" version="1.1" viewBox="0 0 808 634" width="808px" zoomAndPan="magnify"><defs><filter height="300%" id="fcqgdr7cyassn" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="219" x="285.715" y="16.6992">Data flow - old architecture</text><!--MD5=[4034dc877b8eccbaf2b7bb77a2a7acd3]
cluster DPS Service--><path d="M68.0374,394.332 C70.6947,385.7389 76.9779,385.4756 82.3457,391.7177 C85.6176,385.7533 91.2523,384.8118 95.0514,391.1742 C97.9727,384.7082 102.4119,383.8802 106.8173,389.7598 C109.8321,382.4372 116.8524,381.3325 121.0733,388.5797 C123.3546,381.6496 129.6098,380.6612 134.0338,386.3851 C138.3387,381.3556 144.0827,380.6388 146.8279,387.9961 C151.6067,383.4698 156.3646,384.512 158.8913,390.5643 C163.5657,384.6388 167.6407,383.5001 172.0944,390.7849 C177.0471,384.4478 183.3094,386.3041 186.3638,392.8822 C195.3438,387.3039 201.5463,389.3589 204.43,399.7702 C205.4486,399.6584 205.9936,400.4304 205.5446,401.3524 C211.9962,406.0494 211.4338,410.3645 205.0003,414.5293 C212.7741,417.9487 213.0421,423.5908 206.7803,428.7652 C214.2501,432.9 212.9887,438.2499 207.3224,442.889 C214.0374,448.096 213.4793,452.8697 206.8039,457.6049 C213.5693,462.4602 211.8636,467.2227 205.8656,471.1969 C211.855,480.4569 208.6101,488.9098 197.43,490.7702 C198.7838,490.5119 199.8977,491.1008 199.3812,492.717 C195.9494,499.553 189.525,499.1222 185.3619,493.5427 C181.4008,500.4247 177.4376,501.3709 172.0567,494.9644 C169.672,501.7906 164.1774,503.4655 158.629,498.5967 C156.0372,503.7337 150.8814,504.2133 147.4723,499.5247 C144.4629,506.1561 139.5827,508.1784 134.0441,502.223 C128.6578,507.6695 123.9365,505.251 121.3296,499.1601 C116.503,505.458 111.0068,504.2211 107.1275,498.0786 C101.6843,504.0616 97.2999,502.8913 93.62,496.1994 C88.6978,501.4541 83.282,500.1435 81.7225,492.9782 C70.0225,500.7569 63.3666,496.256 60.43,483.7702 C60.9084,483.1651 61.403,483.2108 61.7727,483.8843 C56.1211,481.258 53.619,476.4486 59.3932,471.6077 C52.3099,467.7346 51.8795,461.6719 57.5165,456.2449 C51.4165,451.5844 49.4992,446.9398 57.0097,441.8017 C51.3749,436.4321 51.4433,431.1908 59.1164,427.8275 C52.4229,422.6508 53.6362,418.3187 59.9947,413.9692 C52.2495,404.6531 55.3545,395.1345 67.43,392.7702 C68.3076,392.9819 68.6245,393.5507 68.0374,394.332 " fill="#FFFFFF" filter="url(#fcqgdr7cyassn)" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="81" x="91.93" y="410.7585">DPS Service</text><!--MD5=[4b6597e5202bb255e27abc7ed2ac90aa]
cluster IoT Hub Service--><path d="M99.4435,39.8408 C103.0862,33.4701 107.3149,33.7862 111.9435,38.754 C115.0452,32.0986 120.9504,30.844 125.2999,37.5024 C129.5788,32.2495 133.0803,31.5488 136.8451,38.0092 C140.3241,31.6541 144.1472,29.0399 150.2213,35.2456 C153.8561,28.5294 157.92,29.4092 162.2951,34.4878 C165.8356,28.6882 170.2996,28.3541 174.0237,34.3045 C177.7095,27.7671 183.6681,27.0938 187.8609,33.7737 C192.6212,28.5141 197.842,29.3506 200.3154,36.1379 C203.7885,30.4319 209.0337,30.5249 212.3767,36.2749 C215.6036,32.2834 220.755,32.2431 222.8968,37.5081 C227.438,31.9988 232.3908,31.8041 235.3165,39.0777 C244.6734,33.5799 251.7219,34.0995 254.43,46.2702 C255.4609,46.0479 256.0078,46.7518 255.7761,47.71 C262.6932,51.8991 262.6259,56.7014 255.5908,60.6913 C262.1762,64.4336 263.4091,69.2462 256.9381,74.2828 C264.7012,78.398 264.3245,83.5632 257.6009,88.3605 C265.1201,93.1702 264.5543,99.827 256.7363,103.7765 C262.5537,108.1584 261.9593,112.4981 256.4429,116.6212 C264.0661,127.4503 259.062,134.8456 247.43,137.2702 C247.8798,137.2926 248.0023,137.5761 247.8,137.9523 C244.4637,143.4877 239.3482,144.8487 235.4826,138.501 C233.8749,144.1366 228.509,144.8749 224.6185,141.1505 C220.7685,146.6939 215.113,147.6116 211.206,141.2145 C208.3766,146.7673 203.5796,146.122 200.2938,141.7145 C197.5348,148.8174 190.5207,149.3524 186.1775,143.4316 C182.8119,149.9498 177.838,149.6732 173.5458,144.4267 C169.174,150.9136 165.0428,150.0999 161.1522,143.9545 C156.6784,148.7394 152.7304,148.349 150.1943,142.0404 C145.9502,148.8139 139.6121,147.658 136.8891,140.5794 C133.2565,145.3903 129.5943,146.0305 126.1008,140.4352 C121.3239,147.1024 115.9337,146.1377 111.8953,139.6384 C102.4228,146.4248 92.565,142.8856 92.43,130.2702 C93.6159,129.8275 94.3767,130.5345 94.2113,131.7351 C87.2974,127.2913 86.9644,122.6981 92.5699,116.8719 C84.8804,113.3614 83.2284,108.4831 89.8935,102.3306 C82.8492,99.2964 81.4924,95.4426 87.507,89.9011 C81.6453,84.6961 82.7044,78.0336 89.7777,74.7698 C85.5815,70.3909 85.1639,64.1158 92.6622,62.482 C85.5283,52.2439 87.3708,43.9123 99.43,39.2702 C99.6966,39.42 99.7305,39.678 99.4435,39.8408 " fill="#FFFFFF" filter="url(#fcqgdr7cyassn)" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="105" x="120.93" y="57.2585">IoT Hub Service</text><!--MD5=[be11516feef02b33d46e6014d7ac04df]
cluster Edge Security Daemon--><polygon fill="#FFFFFF" filter="url(#fcqgdr7cyassn)" points="236.43,355.2702,246.43,345.2702,463.43,345.2702,463.43,504.2702,453.43,514.2702,236.43,514.2702,236.43,355.2702" style="stroke: #000000; stroke-width: 1.5;"/><line style="stroke: #000000; stroke-width: 1.5;" x1="453.43" x2="463.43" y1="355.2702" y2="345.2702"/><line style="stroke: #000000; stroke-width: 1.5;" x1="236.43" x2="453.43" y1="355.2702" y2="355.2702"/><line style="stroke: #000000; stroke-width: 1.5;" x1="453.43" x2="453.43" y1="355.2702" y2="514.2702"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="151" x="270.43" y="371.2585">Edge Security Daemon</text><!--MD5=[cd2698047f0d10b671dfbfae9f2dfcaf]
cluster ESD Legacy Service--><polygon fill="#FFFFFF" filter="url(#fcqgdr7cyassn)" points="260.43,393.2702,397.43,393.2702,404.43,415.6765,428.43,415.6765,428.43,490.2702,260.43,490.2702,260.43,393.2702" style="stroke: #000000; stroke-width: 1.5;"/><line style="stroke: #000000; stroke-width: 1.5;" x1="260.43" x2="404.43" y1="415.6765" y2="415.6765"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="131" x="264.43" y="408.2585">ESD Legacy Service</text><!--MD5=[9b13154502175b34a7dde17b32f1f8a1]
cluster Edge Agent--><polygon fill="#FFFFFF" filter="url(#fcqgdr7cyassn)" points="84.43,204.2702,94.43,194.2702,423.43,194.2702,423.43,286.2702,413.43,296.2702,84.43,296.2702,84.43,204.2702" style="stroke: #000000; stroke-width: 1.5;"/><line style="stroke: #000000; stroke-width: 1.5;" x1="413.43" x2="423.43" y1="204.2702" y2="194.2702"/><line style="stroke: #000000; stroke-width: 1.5;" x1="84.43" x2="413.43" y1="204.2702" y2="204.2702"/><line style="stroke: #000000; stroke-width: 1.5;" x1="413.43" x2="413.43" y1="204.2702" y2="296.2702"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="77" x="211.43" y="220.2585">Edge Agent</text><!--MD5=[b606e694e189a5e0bde06dd1b8d0f0e0]
cluster Edge Hub--><polygon fill="#FFFFFF" filter="url(#fcqgdr7cyassn)" points="447.43,204.2702,457.43,194.2702,786.43,194.2702,786.43,286.2702,776.43,296.2702,447.43,296.2702,447.43,204.2702" style="stroke: #000000; stroke-width: 1.5;"/><line style="stroke: #000000; stroke-width: 1.5;" x1="776.43" x2="786.43" y1="204.2702" y2="194.2702"/><line style="stroke: #000000; stroke-width: 1.5;" x1="447.43" x2="776.43" y1="204.2702" y2="204.2702"/><line style="stroke: #000000; stroke-width: 1.5;" x1="776.43" x2="776.43" y1="204.2702" y2="296.2702"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="63" x="581.43" y="220.2585">Edge Hub</text><!--MD5=[e8cfd881e0c7b95e10a1bb0d559cc9f2]
entity DPS Gateway--><rect fill="#FFFFFF" filter="url(#fcqgdr7cyassn)" height="62.8125" style="stroke: #A80036; stroke-width: 1.5;" width="127" x="68.93" y="419.7702"/><rect fill="#FFFFFF" height="10" style="stroke: #A80036; stroke-width: 1.5;" width="15" x="175.93" y="424.7702"/><rect fill="#FFFFFF" height="2" style="stroke: #A80036; stroke-width: 1.5;" width="4" x="173.93" y="426.7702"/><rect fill="#FFFFFF" height="2" style="stroke: #A80036; stroke-width: 1.5;" width="4" x="173.93" y="430.7702"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="55" x="99.93" y="452.7585">«service»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="87" x="83.93" y="469.1648">DPS Gateway</text><!--MD5=[90fbbf7b6c870618297b0507f9a7a4e4]
entity IoTHub Gateway--><rect fill="#FFFFFF" filter="url(#fcqgdr7cyassn)" height="62.8125" style="stroke: #A80036; stroke-width: 1.5;" width="146" x="100.43" y="66.2702"/><rect fill="#FFFFFF" height="10" style="stroke: #A80036; stroke-width: 1.5;" width="15" x="226.43" y="71.2702"/><rect fill="#FFFFFF" height="2" style="stroke: #A80036; stroke-width: 1.5;" width="4" x="224.43" y="73.2702"/><rect fill="#FFFFFF" height="2" style="stroke: #A80036; stroke-width: 1.5;" width="4" x="224.43" y="77.2702"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="55" x="140.93" y="99.2585">«service»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="106" x="115.43" y="115.6648">IoTHub Gateway</text><!--MD5=[c92a214d1cf19bbb25f1b6f29eb3e8ad]
entity ESD API Server--><rect fill="#FFFFFF" filter="url(#fcqgdr7cyassn)" height="46.4063" style="stroke: #A80036; stroke-width: 1.5;" width="135" x="276.93" y="428.2702"/><rect fill="#FFFFFF" height="10" style="stroke: #A80036; stroke-width: 1.5;" width="15" x="391.93" y="433.2702"/><rect fill="#FFFFFF" height="2" style="stroke: #A80036; stroke-width: 1.5;" width="4" x="389.93" y="435.2702"/><rect fill="#FFFFFF" height="2" style="stroke: #A80036; stroke-width: 1.5;" width="4" x="389.93" y="439.2702"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="95" x="291.93" y="461.2585">ESD API Server</text><!--MD5=[1fe0729ee6272b337f45249de52ef7ba]
entity ESD EA Client--><rect fill="#FFFFFF" filter="url(#fcqgdr7cyassn)" height="46.4063" style="stroke: #A80036; stroke-width: 1.5;" width="126" x="281.43" y="234.2702"/><rect fill="#FFFFFF" height="10" style="stroke: #A80036; stroke-width: 1.5;" width="15" x="387.43" y="239.2702"/><rect fill="#FFFFFF" height="2" style="stroke: #A80036; stroke-width: 1.5;" width="4" x="385.43" y="241.2702"/><rect fill="#FFFFFF" height="2" style="stroke: #A80036; stroke-width: 1.5;" width="4" x="385.43" y="245.2702"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="86" x="296.43" y="267.2585">ESD EA Client</text><!--MD5=[cb7b5d334bbf1e92de6363babff7179e]
entity IoTHub EA Client--><rect fill="#FFFFFF" filter="url(#fcqgdr7cyassn)" height="46.4063" style="stroke: #A80036; stroke-width: 1.5;" width="146" x="100.43" y="234.2702"/><rect fill="#FFFFFF" height="10" style="stroke: #A80036; stroke-width: 1.5;" width="15" x="226.43" y="239.2702"/><rect fill="#FFFFFF" height="2" style="stroke: #A80036; stroke-width: 1.5;" width="4" x="224.43" y="241.2702"/><rect fill="#FFFFFF" height="2" style="stroke: #A80036; stroke-width: 1.5;" width="4" x="224.43" y="245.2702"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="106" x="115.43" y="267.2585">IoTHub EA Client</text><!--MD5=[bd69c5fce0e56a932c4fd0c0768bb0c2]
entity ESD EH Client--><rect fill="#FFFFFF" filter="url(#fcqgdr7cyassn)" height="46.4063" style="stroke: #A80036; stroke-width: 1.5;" width="126" x="644.43" y="234.2702"/><rect fill="#FFFFFF" height="10" style="stroke: #A80036; stroke-width: 1.5;" width="15" x="750.43" y="239.2702"/><rect fill="#FFFFFF" height="2" style="stroke: #A80036; stroke-width: 1.5;" width="4" x="748.43" y="241.2702"/><rect fill="#FFFFFF" height="2" style="stroke: #A80036; stroke-width: 1.5;" width="4" x="748.43" y="245.2702"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="86" x="659.43" y="267.2585">ESD EH Client</text><!--MD5=[59f73ad67132c429e47a2962912cd517]
entity IoTHub EH Client--><rect fill="#FFFFFF" filter="url(#fcqgdr7cyassn)" height="46.4063" style="stroke: #A80036; stroke-width: 1.5;" width="146" x="463.43" y="234.2702"/><rect fill="#FFFFFF" height="10" style="stroke: #A80036; stroke-width: 1.5;" width="15" x="589.43" y="239.2702"/><rect fill="#FFFFFF" height="2" style="stroke: #A80036; stroke-width: 1.5;" width="4" x="587.43" y="241.2702"/><rect fill="#FFFFFF" height="2" style="stroke: #A80036; stroke-width: 1.5;" width="4" x="587.43" y="245.2702"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="106" x="478.43" y="267.2585">IoTHub EH Client</text><!--MD5=[ff028a7ac4eed75d9278e76cd9053439]
entity HSM--><path d="M319.43,587.2702 C319.43,577.2702 344.43,577.2702 344.43,577.2702 C344.43,577.2702 369.43,577.2702 369.43,587.2702 L369.43,612.6765 C369.43,622.6765 344.43,622.6765 344.43,622.6765 C344.43,622.6765 319.43,622.6765 319.43,612.6765 L319.43,587.2702 " fill="#FEFECE" filter="url(#fcqgdr7cyassn)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M319.43,587.2702 C319.43,597.2702 344.43,597.2702 344.43,597.2702 C344.43,597.2702 369.43,597.2702 369.43,587.2702 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="30" x="329.43" y="614.2585">HSM</text><!--MD5=[bd5560d50e93d53e212b5741b19e69ac]
link ESD EH Client to ESD API Server--><path d="M669.79,280.3902 C656.48,288.0802 641.36,296.6802 627.43,304.2702 C546.22,348.5402 450.3,397.3002 393.57,425.7702 " fill="none" id="ESD EH Client-to-ESD API Server" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="388.88,428.1302,398.7181,427.6704,393.3493,425.8884,395.1313,420.5196,388.88,428.1302" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="18" x="612.43" y="325.3308">IPC</text><!--MD5=[2adc2dcb1260360b200c594aeb95d455]
link ESD EA Client to ESD API Server--><path d="M344.43,280.2902 C344.43,315.5002 344.43,384.3902 344.43,422.7702 " fill="none" id="ESD EA Client-to-ESD API Server" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="344.43,428.2102,348.43,419.2102,344.43,423.2102,340.43,419.2102,344.43,428.2102" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="18" x="345.43" y="325.3308">IPC</text><!--MD5=[4b60fe133ba5d9edb31abcf258e4e845]
link ESD API Server to HSM--><path d="M344.43,474.5202 C344.43,500.7402 344.43,544.2802 344.43,572.2402 " fill="none" id="ESD API Server-to-HSM" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="344.43,577.2702,348.43,568.2702,344.43,572.2702,340.43,568.2702,344.43,577.2702" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="54" x="345.43" y="543.3308">libiothsm</text><!--MD5=[58db1c2c369caa539f5028032b458490]
reverse link DPS Gateway to ESD API Server--><path d="M201.17,451.2702 C225.42,451.2702 252.66,451.2702 276.82,451.2702 " fill="none" id="DPS Gateway-backto-ESD API Server" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="196.04,451.2702,205.04,455.2702,201.04,451.2702,205.04,447.2702,196.04,451.2702" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="214.93" y="444.3308">HTTPS</text><!--MD5=[62ca745da8344dfdf32ccf37b5ab0390]
reverse link IoTHub Gateway to ESD API Server--><path d="M95.79,131.6502 C73.55,145.1402 51.96,163.1302 39.43,186.2702 C14.47,232.3902 6,263.8602 39.43,304.2702 C89.33,364.5802 141.89,303.3502 212.43,337.2702 C258.65,359.5002 301.69,402.0302 325.4,428.1102 " fill="none" id="IoTHub Gateway-backto-ESD API Server" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="100.24,129.0202,90.4571,130.1584,95.9362,131.5653,94.5293,137.0444,100.24,129.0202" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="40.43" y="261.8308">HTTPS</text><!--MD5=[1ba61940d09e9bcc638ddaa746e5f6f8]
link IoTHub Gateway to IoTHub EH Client--><path d="M251.3,121.2002 C301.53,136.8402 367.66,159.6302 423.43,186.2702 C450.37,199.1402 478.94,216.8802 500.62,231.2802 " fill="none" id="IoTHub Gateway-IoTHub EH Client" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="504.86,234.1102,499.5903,225.7897,500.6997,231.3367,495.1527,232.4461,504.86,234.1102" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="246.49,119.7102,253.8994,126.1988,251.2652,121.1927,256.2713,118.5585,246.49,119.7102" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110" x="404.43" y="174.3308">AMQP (EH Module)</text><!--MD5=[9ea420e6cc9da68af47851fb3bfb9a0b]
reverse link IoTHub Gateway to IoTHub EA Client--><path d="M173.43,134.7002 C173.43,165.3502 173.43,208.4302 173.43,234.2302 " fill="none" id="IoTHub Gateway-backto-IoTHub EA Client" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="173.43,129.5102,169.43,138.5102,173.43,134.5102,177.43,138.5102,173.43,129.5102" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="174.43" y="174.3308">HTTPS</text><!--MD5=[1b9f90dc4838d054c3c2d788654bdbd0]
@startuml
title Data flow - old architecture
cloud "DPS Service" {
    [DPS Gateway] <<service>>
}

cloud "IoT Hub Service" {
    [IoTHub Gateway] <<service>>
}

node "Edge Security Daemon" {
    folder "ESD Legacy Service" {
        [ESD API Server] 
    }
}
node "Edge Agent" {
    [ESD EA Client]
    [IoTHub EA Client]
}
node "Edge Hub" {
    [ESD EH Client]
    [IoTHub EH Client]
}

database "HSM"


[ESD EH Client] - -> [ESD API Server] : IPC
[ESD EA Client] - -> [ESD API Server] : IPC

[ESD API Server] -down-> HSM : libiothsm
[ESD API Server] -left-> [DPS Gateway] : HTTPS

[ESD API Server] -up-> [IoTHub Gateway] : HTTPS
[IoTHub EH Client] <-up-> [IoTHub Gateway] : AMQP (EH Module)
[IoTHub EA Client] -up-> [IoTHub Gateway] : HTTPS

skinparam component {
    backgroundColor White
}

@enduml

PlantUML version 1.2020.17(Sat Sep 19 05:30:11 PDT 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>